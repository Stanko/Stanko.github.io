var Et=Object.defineProperty;var kt=(c,t,n)=>t in c?Et(c,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):c[t]=n;var y=(c,t,n)=>(kt(c,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const d of i)if(d.type==="childList")for(const h of d.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&e(h)}).observe(document,{childList:!0,subtree:!0});function n(i){const d={};return i.integrity&&(d.integrity=i.integrity),i.referrerpolicy&&(d.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?d.credentials="include":i.crossorigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function e(i){if(i.ep)return;i.ep=!0;const d=n(i);fetch(i.href,d)}})();var F=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function qt(c){if(c.__esModule)return c;var t=c.default;if(typeof t=="function"){var n=function e(){if(this instanceof e){var i=[null];i.push.apply(i,arguments);var d=Function.bind.apply(t,i);return new d}return t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(c).forEach(function(e){var i=Object.getOwnPropertyDescriptor(c,e);Object.defineProperty(n,e,i.get?i:{enumerable:!0,get:function(){return c[e]}})}),n}var it={},Tt={get exports(){return it},set exports(c){it=c}};(function(c,t){(function(n,e){e()})(F,function(){function n(s,u){return typeof u>"u"?u={autoBom:!1}:typeof u!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),u={autoBom:!u}),u.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(s.type)?new Blob(["\uFEFF",s],{type:s.type}):s}function e(s,u,a){var f=new XMLHttpRequest;f.open("GET",s),f.responseType="blob",f.onload=function(){r(f.response,u,a)},f.onerror=function(){console.error("could not download file")},f.send()}function i(s){var u=new XMLHttpRequest;u.open("HEAD",s,!1);try{u.send()}catch{}return 200<=u.status&&299>=u.status}function d(s){try{s.dispatchEvent(new MouseEvent("click"))}catch{var u=document.createEvent("MouseEvents");u.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),s.dispatchEvent(u)}}var h=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof F=="object"&&F.global===F?F:void 0,o=h.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),r=h.saveAs||(typeof window!="object"||window!==h?function(){}:"download"in HTMLAnchorElement.prototype&&!o?function(s,u,a){var f=h.URL||h.webkitURL,l=document.createElement("a");u=u||s.name||"download",l.download=u,l.rel="noopener",typeof s=="string"?(l.href=s,l.origin===location.origin?d(l):i(l.href)?e(s,u,a):d(l,l.target="_blank")):(l.href=f.createObjectURL(s),setTimeout(function(){f.revokeObjectURL(l.href)},4e4),setTimeout(function(){d(l)},0))}:"msSaveOrOpenBlob"in navigator?function(s,u,a){if(u=u||s.name||"download",typeof s!="string")navigator.msSaveOrOpenBlob(n(s,a),u);else if(i(s))e(s,u,a);else{var f=document.createElement("a");f.href=s,f.target="_blank",setTimeout(function(){d(f)})}}:function(s,u,a,f){if(f=f||open("","_blank"),f&&(f.document.title=f.document.body.innerText="downloading..."),typeof s=="string")return e(s,u,a);var l=s.type==="application/octet-stream",x=/constructor/i.test(h.HTMLElement)||h.safari,p=/CriOS\/[\d]+/.test(navigator.userAgent);if((p||l&&x||o)&&typeof FileReader<"u"){var m=new FileReader;m.onloadend=function(){var $=m.result;$=p?$:$.replace(/^data:[^;]*;/,"data:attachment/file;"),f?f.location.href=$:location=$,f=null},m.readAsDataURL(s)}else{var M=h.URL||h.webkitURL,A=M.createObjectURL(s);f?f.location=A:location.href=A,f=null,setTimeout(function(){M.revokeObjectURL(A)},4e4)}});h.saveAs=r.saveAs=r,c.exports=r})})(Tt);function zt(c,t){let n=c.length,e=c[0].length,i=t[0].length,d=new Array(n);for(let h=0;h<n;++h){d[h]=new Array(i);for(let o=0;o<i;++o){d[h][o]=0;for(let r=0;r<e;++r)d[h][o]+=c[h][r]*t[r][o]}}return d}class _{constructor(t,n,e){y(this,"matrix");this.matrix=[[t.x,n.x,e.x],[t.y,n.y,e.y],[t.z,n.z,e.z]]}mul(t){const n=[[t.x],[t.y],[t.z]],e=zt(this.matrix,n);return new w(e[0][0],e[1][0],e[2][0])}inv(){const t=this.matrix[0][0],n=this.matrix[0][1],e=this.matrix[0][2],i=this.matrix[1][0],d=this.matrix[1][1],h=this.matrix[1][2],o=this.matrix[2][0],r=this.matrix[2][1],s=this.matrix[2][2];let u=d*s-r*h,a=h*o-i*s,f=i*r-o*d;const l=[u,e*r-n*s,n*h-e*d,a,t*s-e*o,i*e-t*h,f,o*n-t*r,t*d-i*n].map(x=>x/=t*u+n*a+e*f);return new _(new w(l[0],l[3],l[6]),new w(l[1],l[4],l[7]),new w(l[2],l[5],l[8]))}transpose(){const t=this.matrix.map(i=>[...i]);for(var n=0;n<t.length;n++)for(var e=0;e<n;e++){const i=t[n][e];t[n][e]=t[e][n],t[e][n]=i}return new _(new w(t[0][0],t[1][0],t[2][0]),new w(t[0][1],t[1][1],t[2][1]),new w(t[0][2],t[1][2],t[2][2]))}}const{min:Ot,max:Rt}=Math;function B(c,t,n){return Ot(Rt(c,t),n)}function V(c,t,n){return c*(1-n)+t*n}const{random:tt,sqrt:Ft,min:W,max:nt,abs:X,acos:Pt}=Math;class D{constructor(t,n,e){y(this,"x");y(this,"y");y(this,"z");this.x=t,this.y=n,this.z=e}static randomUnitVector(){let t,n,e;for(;t=tt()*2-1,n=tt()*2-1,e=tt()*2-1,!(t*t+n*n+e*e<=1););return new D(t,n,e).normalize()}length(){return Ft(this.x*this.x+this.y*this.y+this.z*this.z)}distance(t){return this.sub(t).length()}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z}distanceSquared(t){return this.sub(t).lengthSquared()}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){const n=this.y*t.z-this.z*t.y,e=this.z*t.x-this.x*t.z,i=this.x*t.y-this.y*t.x;return new D(n,e,i)}perpendicular(t=new D(.1,.1,0)){return this.cross(t).normalize()}normalize(){const t=this.length();return t===0?(console.warn("Length is 0, returning zero vector"),new D(0,0,0)):new D(this.x/t,this.y/t,this.z/t)}add(t){return new D(this.x+t.x,this.y+t.y,this.z+t.z)}sub(t){return new D(this.x-t.x,this.y-t.y,this.z-t.z)}mul(t){return new D(this.x*t.x,this.y*t.y,this.z*t.z)}div(t){return t.x===0||t.y===0||t.z===0?(console.log(`Dividing by zero, vector: ${t}`),new D(0,0,0)):new D(this.x/t.x,this.y/t.y,this.z/t.z)}addScalar(t){return new D(this.x+t,this.y+t,this.z+t)}subScalar(t){return new D(this.x-t,this.y-t,this.z-t)}mulScalar(t){return new D(this.x*t,this.y*t,this.z*t)}divScalar(t){return t===0&&console.warn(`Dividing by zero, n: ${t}`),new D(this.x/t,this.y/t,this.z/t)}min(t){return new D(W(this.x,t.x),W(this.y,t.y),W(this.z,t.z))}max(t){return new D(nt(this.x,t.x),nt(this.y,t.y),nt(this.z,t.z))}clamp(t,n){return new D(B(this.x,t,n),B(this.y,t,n),B(this.z,t,n))}reflect(t){return this.sub(t.mulScalar(2*t.dot(this)))}inverse(){return new D(-this.x,-this.y,-this.z)}abs(){return new D(X(this.x),X(this.y),X(this.z))}pow(t){const{pow:n}=Math;return new D(n(this.x,t),n(this.y,t),n(this.z,t))}angleBetween(t){const n=this.normalize().dot(t.normalize()),e=parseFloat(n.toFixed(5));return Pt(e)}project(t){const n=this.dot(t)/t.dot(t);return this.mulScalar(n)}minAxis(){const t=X(this.x),n=X(this.y),e=X(this.z);return t<=n&&t<=e?new D(1,0,0):n<=t&&n<=e?new D(0,1,0):new D(0,0,1)}minComponent(){return W(this.x,this.y,this.z)}segmentDistance(t,n){const e=t.distanceSquared(n);if(e===0)return this.distance(t);const i=this.sub(t).dot(n.sub(t))/e;return i<0?this.distance(t):i>1?this.distance(n):t.add(n.sub(t).mulScalar(i)).distance(this)}toString(){return`Vector(${this.x}, ${this.y}, ${this.z})`}}const w=D,{abs:xt}=Math;class z{constructor(t,n){y(this,"x");y(this,"y");this.x=t,this.y=n}static randomUnitVector(){let t,n;for(;t=Math.random()*2-1,n=Math.random()*2-1,!(t*t+n*n<=1););return new z(t,n).normalize()}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}distance(t){return this.sub(t).length()}lengthSquared(){return this.x*this.x+this.y*this.y}distanceSquared(t){return this.sub(t).lengthSquared()}dot(t){return this.x*t.x+this.y*t.y}cross(t){const n=this.x*t.y-this.y*t.x;return new w(0,0,n)}normalize(){const t=this.length();return t===0?(console.warn("Length is 0, returning zero vector"),new z(0,0)):new z(this.x/t,this.y/t)}add(t){return new z(this.x+t.x,this.y+t.y)}sub(t){return new z(this.x-t.x,this.y-t.y)}mul(t){return new z(this.x*t.x,this.y*t.y)}abs(){return new z(xt(this.x),xt(this.y))}div(t){if(t.x===0||t.y===0)throw new Error(`Dividing by zero, vector: ${t}`);return new z(this.x/t.x,this.y/t.y)}addScalar(t){return new z(this.x+t,this.y+t)}subScalar(t){return new z(this.x-t,this.y-t)}mulScalar(t){return new z(this.x*t,this.y*t)}divScalar(t){return t===0&&console.warn(`Dividing by zero, n: ${t}`),new z(this.x/t,this.y/t)}min(t){return new z(Math.min(this.x,t.x),Math.min(this.y,t.y))}max(t){return new z(Math.max(this.x,t.x),Math.max(this.y,t.y))}minAxis(){const t=Math.abs(this.x),n=Math.abs(this.y);return t<=n?new z(1,0):new z(0,1)}minComponent(){return Math.min(this.x,this.y)}segmentDistance(t,n){const e=t.distanceSquared(n);if(e===0)return this.distance(t);const i=this.sub(t).dot(n.sub(t))/e;return i<0?this.distance(t):i>1?this.distance(n):t.add(n.sub(t).mulScalar(i)).distance(this)}toString(){return`Vector(${this.x}, ${this.y})`}}const Ct=255,Nt=0,_t=100,Q=1e-4;function It(c,t,n){let e=t.minDist,i=t.position.add(n.mulScalar(e));for(let d=0;d<Ct;d++){const h=c.distance(i);if(h<Q)return{distance:e,ray:i};if(e+=h,i=t.position.add(n.mulScalar(e)),e>=t.maxDist)return{distance:t.maxDist,ray:i}}return{distance:t.maxDist,ray:i}}function Xt(c,t,n){const e=n.sub(t.divScalar(2)),i=t.y/2/Math.tan(c/2);return new w(e.x,e.y,-i).normalize()}function Bt(c,t,n,e){const i=t.fov/2,d=n.x/n.y,h=e.mul(c),o=Math.tan(i),r=o*d;let s=h.y/o/-h.z;s=(s+1)/2;let u=h.x/r/-h.z;return u=(u+1)/2,new z(u*n.x,s*n.y)}function Ut(c,t,n){const e=t.sub(c).normalize(),i=e.cross(n).normalize(),d=i.cross(e);return new _(i,d,e.inverse())}var St={};/**
 * k-d Tree JavaScript - V 1.01
 *
 * https://github.com/ubilabs/kd-tree-javascript
 *
 * @author Mircea Pricop <pricop@ubilabs.net>, 2012
 * @author Martin Kleppe <kleppe@ubilabs.net>, 2012
 * @author Ubilabs http://ubilabs.net, 2012
 * @license MIT License <http://www.opensource.org/licenses/mit-license.php>
 */(function(c){(function(t,n){n(c)})(F,function(t){function n(i,d,h){this.obj=i,this.left=null,this.right=null,this.parent=h,this.dimension=d}function e(i){this.content=[],this.scoreFunction=i}e.prototype={push:function(i){this.content.push(i),this.bubbleUp(this.content.length-1)},pop:function(){var i=this.content[0],d=this.content.pop();return this.content.length>0&&(this.content[0]=d,this.sinkDown(0)),i},peek:function(){return this.content[0]},remove:function(i){for(var d=this.content.length,h=0;h<d;h++)if(this.content[h]==i){var o=this.content.pop();return void(h!=d-1&&(this.content[h]=o,this.scoreFunction(o)<this.scoreFunction(i)?this.bubbleUp(h):this.sinkDown(h)))}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(i){for(var d=this.content[i];i>0;){var h=Math.floor((i+1)/2)-1,o=this.content[h];if(!(this.scoreFunction(d)<this.scoreFunction(o)))break;this.content[h]=d,this.content[i]=o,i=h}},sinkDown:function(i){for(var d=this.content.length,h=this.content[i],o=this.scoreFunction(h);;){var r=2*(i+1),s=r-1,u=null;if(s<d){var a=this.content[s],f=this.scoreFunction(a);f<o&&(u=s)}if(r<d){var l=this.content[r];this.scoreFunction(l)<(u==null?o:f)&&(u=r)}if(u==null)break;this.content[i]=this.content[u],this.content[u]=h,i=u}}},t.kdTree=function(i,d,h){function o(s,u,a){var f,l,x=u%h.length;return s.length===0?null:s.length===1?new n(s[0],x,a):(s.sort(function(p,m){return p[h[x]]-m[h[x]]}),f=Math.floor(s.length/2),l=new n(s[f],x,a),l.left=o(s.slice(0,f),u+1,l),l.right=o(s.slice(f+1),u+1,l),l)}var r=this;Array.isArray(i)?this.root=o(i,0,null):function(s){function u(a){a.left&&(a.left.parent=a,u(a.left)),a.right&&(a.right.parent=a,u(a.right))}r.root=s,u(r.root)}(i),this.toJSON=function(s){s||(s=this.root);var u=new n(s.obj,s.dimension,null);return s.left&&(u.left=r.toJSON(s.left)),s.right&&(u.right=r.toJSON(s.right)),u},this.insert=function(s){function u(x,p){if(x===null)return p;var m=h[x.dimension];return s[m]<x.obj[m]?u(x.left,x):u(x.right,x)}var a,f,l=u(this.root,null);l!==null?(a=new n(s,(l.dimension+1)%h.length,l),f=h[l.dimension],s[f]<l.obj[f]?l.left=a:l.right=a):this.root=new n(s,0,null)},this.remove=function(s){function u(l){if(l===null)return null;if(l.obj===s)return l;var x=h[l.dimension];return s[x]<l.obj[x]?u(l.left):u(l.right)}function a(l){function x(A,$){var g,b,j,S,v;return A===null?null:(g=h[$],A.dimension===$?A.left!==null?x(A.left,$):A:(b=A.obj[g],j=x(A.left,$),S=x(A.right,$),v=A,j!==null&&j.obj[g]<b&&(v=j),S!==null&&S.obj[g]<v.obj[g]&&(v=S),v))}var p,m,M;if(l.left===null&&l.right===null)return l.parent===null?void(r.root=null):(M=h[l.parent.dimension],void(l.obj[M]<l.parent.obj[M]?l.parent.left=null:l.parent.right=null));l.right!==null?(m=(p=x(l.right,l.dimension)).obj,a(p),l.obj=m):(m=(p=x(l.left,l.dimension)).obj,a(p),l.right=l.left,l.left=null,l.obj=m)}var f;(f=u(r.root))!==null&&a(f)},this.nearest=function(s,u,a){function f(m){function M(k,L){p.push([k,L]),p.size()>u&&p.pop()}var A,$,g,b,j=h[m.dimension],S=d(s,m.obj),v={};for(b=0;b<h.length;b+=1)b===m.dimension?v[h[b]]=s[h[b]]:v[h[b]]=m.obj[h[b]];$=d(v,m.obj),m.right!==null||m.left!==null?(f(A=m.right===null?m.left:m.left===null?m.right:s[j]<m.obj[j]?m.left:m.right),(p.size()<u||S<p.peek()[1])&&M(m,S),(p.size()<u||Math.abs($)<p.peek()[1])&&(g=A===m.left?m.right:m.left)!==null&&f(g)):(p.size()<u||S<p.peek()[1])&&M(m,S)}var l,x,p;if(p=new e(function(m){return-m[1]}),a)for(l=0;l<u;l+=1)p.push([null,a]);for(r.root&&f(r.root),x=[],l=0;l<Math.min(u,p.content.length);l+=1)p.content[l][0]&&x.push([p.content[l][0].obj,p.content[l][1]]);return x},this.balanceFactor=function(){function s(a){return a===null?0:Math.max(s(a.left),s(a.right))+1}function u(a){return a===null?0:u(a.left)+u(a.right)+1}return s(r.root)/(Math.log(u(r.root))/Math.log(2))}},t.BinaryHeap=e})})(St);function Mt(c,t){const n=Q,e=new z(1,-1),i=new w(e.x,e.y,e.y),d=new w(e.y,e.y,e.x),h=new w(e.y,e.x,e.y),o=new w(e.x,e.x,e.x);return i.mulScalar(t(c.add(i.mulScalar(n)))).add(d.mulScalar(t(c.add(d.mulScalar(n))))).add(h.mulScalar(t(c.add(h.mulScalar(n))))).add(o.mulScalar(t(c.add(o.mulScalar(n))))).normalize()}const Gt=.5*(Math.sqrt(3)-1),H=(3-Math.sqrt(3))/6,yt=c=>Math.floor(c)|0,wt=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function Ht(c=Math.random){const t=Wt(c),n=new Float64Array(t).map(i=>wt[i%12*2]),e=new Float64Array(t).map(i=>wt[i%12*2+1]);return function(d,h){let o=0,r=0,s=0;const u=(d+h)*Gt,a=yt(d+u),f=yt(h+u),l=(a+f)*H,x=a-l,p=f-l,m=d-x,M=h-p;let A,$;m>M?(A=1,$=0):(A=0,$=1);const g=m-A+H,b=M-$+H,j=m-1+2*H,S=M-1+2*H,v=a&255,k=f&255;let L=.5-m*m-M*M;if(L>=0){const E=v+t[k],O=n[E],P=e[E];L*=L,o=L*L*(O*m+P*M)}let q=.5-g*g-b*b;if(q>=0){const E=v+A+t[k+$],O=n[E],P=e[E];q*=q,r=q*q*(O*g+P*b)}let T=.5-j*j-S*S;if(T>=0){const E=v+1+t[k+1],O=n[E],P=e[E];T*=T,s=T*T*(O*j+P*S)}return 70*(o+r+s)}}function Wt(c){const n=new Uint8Array(512);for(let e=0;e<512/2;e++)n[e]=e;for(let e=0;e<512/2-1;e++){const i=e+~~(c()*(256-e)),d=n[e];n[e]=n[i],n[i]=d}for(let e=256;e<512;e++)n[e]=n[e-256];return n}function Kt(c,t){const n=c.x-t.x,e=c.y-t.y;return Math.sqrt(n*n+e*e)}function Jt(c){return .299*c.x+.587*c.y+.114*c.z}Ht();class Yt{constructor(t){y(this,"scene");y(this,"tree");y(this,"maxLineLength",1e3);y(this,"easing",t=>t*3);this.scene=t,this.tree=new St.kdTree([],Kt,["x","y"])}getPoint(t,n){const{color:e,ray:i,rayDirection:d,object:h,distance:o}=this.scene.getPixel(new z(t,n));return{x:t,y:n,ray:i,rayDirection:d,normal:Mt(i,h.distance),miss:o>this.scene.camera.maxDist,value:1-Jt(e)}}getRandomPoint(){let t=Math.random()*this.scene.size.x,n=Math.random()*this.scene.size.y;return this.getPoint(t,n)}getNextPoint(t){const n=location.hash==="#ray",e=t.rayDirection.add((n?t.ray:t.rayDirection).perpendicular(t.normal).divScalar(500)),i=Bt(e,this.scene.camera,this.scene.size,this.scene.worldToView);return this.getPoint(i.x,i.y)}shouldDraw(t){if(t.value<Q)return!1;const n=1/this.easing(t.value),e=this.tree.nearest(t,1,n);return e.length===0?!0:e[0][1]>n}doNext(t,n){const e=this.getNextPoint(t),i=Math.PI*.3;if(!(e.normal.angleBetween(t.normal)>i)&&e.value>0&&this.shouldDraw(e)){if(n.push(e),n.length>this.maxLineLength||e.x<0||e.x>this.scene.size.x||e.y<0||e.y>this.scene.size.y)return;this.doNext(e,n)}}getLines(){const t=[];let n=[],e=this.getRandomPoint(),i=0;const d=5e4;for(;e&&!(i++>d);){if(e.miss){e=this.getRandomPoint();continue}this.shouldDraw(e)?(n=[e],this.doNext(e,n),n.forEach(o=>{this.tree.insert(o)}),n.length>1&&t.push(n)):e=this.getRandomPoint(),n=[]}return t}}const{pow:et}=Math;class Qt{constructor(t,n){y(this,"lights",[]);y(this,"objects",[]);y(this,"size");y(this,"ambientLight",{color:new w(1,1,1),intensity:0});y(this,"background",new w(1,1,1));y(this,"camera");y(this,"svgRenderer");y(this,"viewToWorld");y(this,"worldToView");y(this,"add",this.addObject);y(this,"traceObject",(t,n)=>{const e=Xt(this.camera.fov,this.size,n),i=this.viewToWorld.mul(e),{distance:d,ray:h}=It(t,this.camera,i);if(d>this.camera.maxDist-Q)return{ray:h,rayDirection:i,distance:d,object:t,color:this.background};let o=t.color;const r=this.ambientLight.color.mulScalar(this.ambientLight.intensity);return o=o.add(r),o=new w(et(o.x,.4545),et(o.y,.4545),et(o.z,.4545)),{ray:h,rayDirection:i,distance:d,object:t,color:o}});this.size=t,this.camera=n,this.viewToWorld=Ut(this.camera.position,this.camera.lookAt,this.camera.up),this.worldToView=this.viewToWorld.inv()}addObject(t){this.objects.push(t)}addLight(t){this.lights.push(t)}getPixel(t){let n=-1,e=1/0,i;this.objects.forEach((h,o)=>{const r=this.traceObject(h,t);r.distance<e&&(e=r.distance,n=o,i=r)});let d=this.objects[n];return this.lights.forEach(h=>{const o=h.getValue(i.ray,d,this.camera.position);i.color=i.color.add(o)}),i}getVectorImage(){return this.svgRenderer=new Yt(this),this.svgRenderer.getLines()}render(t){const n=this.getVectorImage();let e=`
    <rect fill="#fbfff4" x="0" y="0" width="${this.size.x}" height="${this.size.y}" />
    <g 
      fill="none" 
      stroke="black" 
      stroke-width="0.5" 
      stroke-linecap="round"
      stroke-linejoin="round"
      transform="scale(1,-1) translate(0, ${-this.size.y})"
    >`;e+=n.map(i=>`
        <path style="opacity:0" d="M ${i.map(h=>`${h.x.toFixed(2)} ${h.y.toFixed(2)}`).join(" L ")}" />
      `).join(`
`),e+="</g>",t.setAttribute("viewBox",`0 0 ${this.size.x} ${this.size.y}`),t.innerHTML=e,document.querySelectorAll("path").forEach(i=>setTimeout(()=>i.style.opacity="1",Math.random()*2e3))}getRasterImage(){const t=[];for(let n=0;n<this.size.x;n++){t[n]=[];for(let e=0;e<this.size.y;e++){const i=new z(n+.5,e+.5),d=this.getPixel(i);t[n][e]=d.color}}return t}renderCanvas(t){const n=this.getRasterImage(),e=t.getContext("2d"),i=1;t.width=this.size.x*i,t.height=this.size.y*i,n.forEach((d,h)=>{d.reverse().forEach((o,r)=>{o.x+o.y+o.z>=3||(e.fillStyle=`rgb(${Math.ceil(o.x*255)}, ${Math.ceil(o.y*255)}, ${Math.ceil(o.z*255)})`,e.fillRect(h*i,r*i,i,i))})})}}class Zt{constructor(t,n=new w(0,0,0),e=new w(0,1,0)){y(this,"position");y(this,"lookAt");y(this,"up");y(this,"fov",Math.PI*.25);y(this,"minDist",Nt);y(this,"maxDist",_t);this.position=t,this.lookAt=n,this.up=e}}const{min:Vt,max:mt,abs:tn}=Math;class ft{constructor(t){y(this,"sdf");y(this,"binaryOperations",[]);y(this,"operations",[]);y(this,"position",new w(0,0,0));y(this,"scale",new w(1,1,1));y(this,"color");y(this,"shininess");y(this,"distance",t=>{let n=t.add(this.position),e=this.sdf.distance(n);return this.binaryOperations.forEach(i=>{const{op:d,sdf:h,param:o}=i;e=d(n,e,h,o)}),this.operations.forEach(i=>{const{op:d,param:h}=i;e=d(e,h)}),e});this.sdf=t,this.color=this.sdf.color,this.shininess=this.sdf.shininess}union(t){return this.binaryOperations.push({op:this._union,sdf:t}),this}subtraction(t){return this.binaryOperations.push({op:this._subtraction,sdf:t}),this}intersection(t){return this.binaryOperations.push({op:this._intersection,sdf:t}),this}unionSmooth(t,n=.1){return this.binaryOperations.push({op:this._unionSmooth,sdf:t,param:n}),this}subtractionSmooth(t,n=.1){return this.binaryOperations.push({op:this._subtractionSmooth,sdf:t,param:n}),this}intersectionSmooth(t,n=.1){return this.binaryOperations.push({op:this._intersectionSmooth,sdf:t,param:n}),this}round(t=.1){return this.operations.push({op:this._round,param:t}),this}onion(t=.1){return this.operations.push({op:this._onion,param:t}),this}_union(t,n,e){const i=n,d=e.distance(t);return Vt(i,d)}_subtraction(t,n,e){const i=n,d=e.distance(t);return mt(-d,i)}_intersection(t,n,e){const i=n,d=e.distance(t);return mt(i,d)}_unionSmooth(t,n,e,i=.1){const d=n,h=e.distance(t),o=B(.5+.5*(h-d)/i,0,1);return V(h,d,o)-i*o*(1-o)}_subtractionSmooth(t,n,e,i=.1){const d=e.distance(t),h=n,o=B(.5-.5*(h+d)/i,0,1);return V(h,-d,o)+i*o*(1-o)}_intersectionSmooth(t,n,e,i=.1){const d=n,h=e.distance(t),o=B(.5-.5*(h-d)/i,0,1);return V(h,d,o)+i*o*(1-o)}_round(t,n=.1){return t-n}_onion(t,n=.1){return tn(t)-n}}class At{constructor(t,n){y(this,"matrix");this.matrix=[[t.x,n.x],[t.y,n.y]]}mul(t){const n=[[t.x],[t.y]],e=zt(this.matrix,n);return new z(e[0][0],e[1][0])}}const{sin:C,cos:N,min:pt}=Math,nn=(c,t,n)=>{const e=N(t*c[n]),i=C(t*c[n]),d=new At(new z(e,-i),new z(i,e));let h;if(n==="x"){const o=d.mul(new z(c.x,c.y));h=new w(o.x,o.y,c.z)}else if(n==="y"){const o=d.mul(new z(c.y,c.z));h=new w(c.x,o.x,o.y)}else{const o=d.mul(new z(c.x,c.z));h=new w(o.x,c.y,o.y)}return h},en=(c,t,n)=>{const e=N(t*c[n]),i=C(t*c[n]),d=new At(new z(e,-i),new z(i,e));let h;if(n==="x"){const o=d.mul(new z(c.y,c.z));h=new w(c.x,o.x,o.y)}else if(n==="y"){const o=d.mul(new z(c.x,c.z));h=new w(o.x,c.y,o.y)}else{const o=d.mul(new z(c.x,c.y));h=new w(o.x,o.y,c.z)}return h};class Z{constructor(){y(this,"position",new w(0,0,0));y(this,"rotation",new w(0,0,0));y(this,"scale",new w(1,1,1));y(this,"displacer",null);y(this,"color",new w(.3,.3,.3));y(this,"shininess",10);y(this,"twistAmount",0);y(this,"twistAxis","x");y(this,"bendAmount",0);y(this,"bendAxis","x");y(this,"distance",t=>{let n,e=t.add(this.position);if(this.rotation.x){const i=this.rotation.x;e=new _(new w(1,0,0),new w(0,N(i),C(i)),new w(0,-C(i),N(i))).mul(e)}if(this.rotation.y){const i=this.rotation.y;e=new _(new w(N(i),0,-C(i)),new w(0,1,0),new w(C(i),0,N(i))).mul(e)}if(this.rotation.z){const i=this.rotation.z;e=new _(new w(N(i),-C(i),0),new w(C(i),N(i),0),new w(0,0,1)).mul(e)}return this.twistAmount&&(e=en(e,this.twistAmount,this.twistAxis)),this.bendAmount&&(e=nn(e,this.bendAmount,this.bendAxis)),n=this._calc(e.div(this.scale))*pt(this.scale.x,pt(this.scale.y,this.scale.z)),this.displacer&&(n=n+this.displacer(e)),n})}displace(t=null){return this.displacer=t,this}twist(t,n="y"){return this.twistAmount=t,this.twistAxis=n,this}bend(t,n="x"){return this.bendAmount=t,this.bendAxis=n,this}_calc(t){throw new Error("Not implemented")}}const{min:rn,max:gt}=Math;class sn extends Z{constructor(n){super();y(this,"size",new w(.5,.5,.5));this.size=n.divScalar(2)}_calc(n){const e=n.abs().sub(this.size),i=rn(gt(e.x,gt(e.y,e.z)),0),d=e.max(new w(0,0,0)).length();return i+d}}class bt extends Z{constructor(n,e){super();y(this,"radius");y(this,"thickness");this.radius=n-e/2,this.thickness=e}_calc(n){const{x:e,y:i,z:d}=n;return Math.sqrt((Math.sqrt(e**2+i**2)-this.radius)**2+d**2)-this.thickness/2}}class on extends Z{constructor(n,e){super();y(this,"n");y(this,"h");this.n=n.normalize(),this.h=e}_calc(n){return n.dot(this.n)+this.h}}class an extends Z{constructor(n){super();y(this,"radius");this.radius=n}_calc(n){return n.length()-this.radius}}const{pow:cn}=Math;function un(c,t,n,e,i,d,h,o){const r=Mt(c,t),s=n.sub(c).normalize(),u=o.sub(c).normalize(),f=s.inverse().reflect(r).normalize(),l=s.dot(r),x=f.dot(u);return l<0?new w(0,0,0):x<0?e.mul(i.mulScalar(l)):e.mul(i.mulScalar(l).add(d.mulScalar(cn(x,h))))}class ln{constructor(t,n,e,i){y(this,"position");y(this,"intensity");y(this,"diffuseColor");y(this,"specularColor");this.position=t,this.intensity=n,this.diffuseColor=e,this.specularColor=i}getValue(t,n,e){return un(t,n.distance,this.position,this.intensity,this.diffuseColor,this.specularColor,n.shininess,e)}}var rt={},hn={get exports(){return rt},set exports(c){rt=c}};(function(c){(function(t,n,e){function i(r){var s=this,u=o();s.next=function(){var a=2091639*s.s0+s.c*23283064365386963e-26;return s.s0=s.s1,s.s1=s.s2,s.s2=a-(s.c=a|0)},s.c=1,s.s0=u(" "),s.s1=u(" "),s.s2=u(" "),s.s0-=u(r),s.s0<0&&(s.s0+=1),s.s1-=u(r),s.s1<0&&(s.s1+=1),s.s2-=u(r),s.s2<0&&(s.s2+=1),u=null}function d(r,s){return s.c=r.c,s.s0=r.s0,s.s1=r.s1,s.s2=r.s2,s}function h(r,s){var u=new i(r),a=s&&s.state,f=u.next;return f.int32=function(){return u.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,a&&(typeof a=="object"&&d(a,u),f.state=function(){return d(u,{})}),f}function o(){var r=4022871197,s=function(u){u=String(u);for(var a=0;a<u.length;a++){r+=u.charCodeAt(a);var f=.02519603282416938*r;r=f>>>0,f-=r,f*=r,r=f>>>0,f-=r,r+=f*4294967296}return(r>>>0)*23283064365386963e-26};return s}n&&n.exports?n.exports=h:e&&e.amd?e(function(){return h}):this.alea=h})(F,c,!1)})(hn);var st={},fn={get exports(){return st},set exports(c){st=c}};(function(c){(function(t,n,e){function i(o){var r=this,s="";r.x=0,r.y=0,r.z=0,r.w=0,r.next=function(){var a=r.x^r.x<<11;return r.x=r.y,r.y=r.z,r.z=r.w,r.w^=r.w>>>19^a^a>>>8},o===(o|0)?r.x=o:s+=o;for(var u=0;u<s.length+64;u++)r.x^=s.charCodeAt(u)|0,r.next()}function d(o,r){return r.x=o.x,r.y=o.y,r.z=o.z,r.w=o.w,r}function h(o,r){var s=new i(o),u=r&&r.state,a=function(){return(s.next()>>>0)/4294967296};return a.double=function(){do var f=s.next()>>>11,l=(s.next()>>>0)/4294967296,x=(f+l)/(1<<21);while(x===0);return x},a.int32=s.next,a.quick=a,u&&(typeof u=="object"&&d(u,s),a.state=function(){return d(s,{})}),a}n&&n.exports?n.exports=h:e&&e.amd?e(function(){return h}):this.xor128=h})(F,c,!1)})(fn);var ot={},dn={get exports(){return ot},set exports(c){ot=c}};(function(c){(function(t,n,e){function i(o){var r=this,s="";r.next=function(){var a=r.x^r.x>>>2;return r.x=r.y,r.y=r.z,r.z=r.w,r.w=r.v,(r.d=r.d+362437|0)+(r.v=r.v^r.v<<4^(a^a<<1))|0},r.x=0,r.y=0,r.z=0,r.w=0,r.v=0,o===(o|0)?r.x=o:s+=o;for(var u=0;u<s.length+64;u++)r.x^=s.charCodeAt(u)|0,u==s.length&&(r.d=r.x<<10^r.x>>>4),r.next()}function d(o,r){return r.x=o.x,r.y=o.y,r.z=o.z,r.w=o.w,r.v=o.v,r.d=o.d,r}function h(o,r){var s=new i(o),u=r&&r.state,a=function(){return(s.next()>>>0)/4294967296};return a.double=function(){do var f=s.next()>>>11,l=(s.next()>>>0)/4294967296,x=(f+l)/(1<<21);while(x===0);return x},a.int32=s.next,a.quick=a,u&&(typeof u=="object"&&d(u,s),a.state=function(){return d(s,{})}),a}n&&n.exports?n.exports=h:e&&e.amd?e(function(){return h}):this.xorwow=h})(F,c,!1)})(dn);var at={},xn={get exports(){return at},set exports(c){at=c}};(function(c){(function(t,n,e){function i(o){var r=this;r.next=function(){var u=r.x,a=r.i,f,l;return f=u[a],f^=f>>>7,l=f^f<<24,f=u[a+1&7],l^=f^f>>>10,f=u[a+3&7],l^=f^f>>>3,f=u[a+4&7],l^=f^f<<7,f=u[a+7&7],f=f^f<<13,l^=f^f<<9,u[a]=l,r.i=a+1&7,l};function s(u,a){var f,l=[];if(a===(a|0))l[0]=a;else for(a=""+a,f=0;f<a.length;++f)l[f&7]=l[f&7]<<15^a.charCodeAt(f)+l[f+1&7]<<13;for(;l.length<8;)l.push(0);for(f=0;f<8&&l[f]===0;++f);for(f==8?l[7]=-1:l[f],u.x=l,u.i=0,f=256;f>0;--f)u.next()}s(r,o)}function d(o,r){return r.x=o.x.slice(),r.i=o.i,r}function h(o,r){o==null&&(o=+new Date);var s=new i(o),u=r&&r.state,a=function(){return(s.next()>>>0)/4294967296};return a.double=function(){do var f=s.next()>>>11,l=(s.next()>>>0)/4294967296,x=(f+l)/(1<<21);while(x===0);return x},a.int32=s.next,a.quick=a,u&&(u.x&&d(u,s),a.state=function(){return d(s,{})}),a}n&&n.exports?n.exports=h:e&&e.amd?e(function(){return h}):this.xorshift7=h})(F,c,!1)})(xn);var ct={},yn={get exports(){return ct},set exports(c){ct=c}};(function(c){(function(t,n,e){function i(o){var r=this;r.next=function(){var u=r.w,a=r.X,f=r.i,l,x;return r.w=u=u+1640531527|0,x=a[f+34&127],l=a[f=f+1&127],x^=x<<13,l^=l<<17,x^=x>>>15,l^=l>>>12,x=a[f]=x^l,r.i=f,x+(u^u>>>16)|0};function s(u,a){var f,l,x,p,m,M=[],A=128;for(a===(a|0)?(l=a,a=null):(a=a+"\0",l=0,A=Math.max(A,a.length)),x=0,p=-32;p<A;++p)a&&(l^=a.charCodeAt((p+32)%a.length)),p===0&&(m=l),l^=l<<10,l^=l>>>15,l^=l<<4,l^=l>>>13,p>=0&&(m=m+1640531527|0,f=M[p&127]^=l+m,x=f==0?x+1:0);for(x>=128&&(M[(a&&a.length||0)&127]=-1),x=127,p=4*128;p>0;--p)l=M[x+34&127],f=M[x=x+1&127],l^=l<<13,f^=f<<17,l^=l>>>15,f^=f>>>12,M[x]=l^f;u.w=m,u.X=M,u.i=x}s(r,o)}function d(o,r){return r.i=o.i,r.w=o.w,r.X=o.X.slice(),r}function h(o,r){o==null&&(o=+new Date);var s=new i(o),u=r&&r.state,a=function(){return(s.next()>>>0)/4294967296};return a.double=function(){do var f=s.next()>>>11,l=(s.next()>>>0)/4294967296,x=(f+l)/(1<<21);while(x===0);return x},a.int32=s.next,a.quick=a,u&&(u.X&&d(u,s),a.state=function(){return d(s,{})}),a}n&&n.exports?n.exports=h:e&&e.amd?e(function(){return h}):this.xor4096=h})(F,c,!1)})(yn);var ut={},wn={get exports(){return ut},set exports(c){ut=c}};(function(c){(function(t,n,e){function i(o){var r=this,s="";r.next=function(){var a=r.b,f=r.c,l=r.d,x=r.a;return a=a<<25^a>>>7^f,f=f-l|0,l=l<<24^l>>>8^x,x=x-a|0,r.b=a=a<<20^a>>>12^f,r.c=f=f-l|0,r.d=l<<16^f>>>16^x,r.a=x-a|0},r.a=0,r.b=0,r.c=-1640531527,r.d=1367130551,o===Math.floor(o)?(r.a=o/4294967296|0,r.b=o|0):s+=o;for(var u=0;u<s.length+20;u++)r.b^=s.charCodeAt(u)|0,r.next()}function d(o,r){return r.a=o.a,r.b=o.b,r.c=o.c,r.d=o.d,r}function h(o,r){var s=new i(o),u=r&&r.state,a=function(){return(s.next()>>>0)/4294967296};return a.double=function(){do var f=s.next()>>>11,l=(s.next()>>>0)/4294967296,x=(f+l)/(1<<21);while(x===0);return x},a.int32=s.next,a.quick=a,u&&(typeof u=="object"&&d(u,s),a.state=function(){return d(s,{})}),a}n&&n.exports?n.exports=h:e&&e.amd?e(function(){return h}):this.tychei=h})(F,c,!1)})(wn);var lt={},mn={get exports(){return lt},set exports(c){lt=c}};const pn={},gn=Object.freeze(Object.defineProperty({__proto__:null,default:pn},Symbol.toStringTag,{value:"Module"})),bn=qt(gn);(function(c){(function(t,n,e){var i=256,d=6,h=52,o="random",r=e.pow(i,d),s=e.pow(2,h),u=s*2,a=i-1,f;function l(g,b,j){var S=[];b=b==!0?{entropy:!0}:b||{};var v=M(m(b.entropy?[g,$(n)]:g??A(),3),S),k=new x(S),L=function(){for(var q=k.g(d),T=r,E=0;q<s;)q=(q+E)*i,T*=i,E=k.g(1);for(;q>=u;)q/=2,T/=2,E>>>=1;return(q+E)/T};return L.int32=function(){return k.g(4)|0},L.quick=function(){return k.g(4)/4294967296},L.double=L,M($(k.S),n),(b.pass||j||function(q,T,E,O){return O&&(O.S&&p(O,k),q.state=function(){return p(k,{})}),E?(e[o]=q,T):q})(L,v,"global"in b?b.global:this==e,b.state)}function x(g){var b,j=g.length,S=this,v=0,k=S.i=S.j=0,L=S.S=[];for(j||(g=[j++]);v<i;)L[v]=v++;for(v=0;v<i;v++)L[v]=L[k=a&k+g[v%j]+(b=L[v])],L[k]=b;(S.g=function(q){for(var T,E=0,O=S.i,P=S.j,G=S.S;q--;)T=G[O=a&O+1],E=E*i+G[a&(G[O]=G[P=a&P+T])+(G[P]=T)];return S.i=O,S.j=P,E})(i)}function p(g,b){return b.i=g.i,b.j=g.j,b.S=g.S.slice(),b}function m(g,b){var j=[],S=typeof g,v;if(b&&S=="object")for(v in g)try{j.push(m(g[v],b-1))}catch{}return j.length?j:S=="string"?g:g+"\0"}function M(g,b){for(var j=g+"",S,v=0;v<j.length;)b[a&v]=a&(S^=b[a&v]*19)+j.charCodeAt(v++);return $(b)}function A(){try{var g;return f&&(g=f.randomBytes)?g=g(i):(g=new Uint8Array(i),(t.crypto||t.msCrypto).getRandomValues(g)),$(g)}catch{var b=t.navigator,j=b&&b.plugins;return[+new Date,t,j,t.screen,$(n)]}}function $(g){return String.fromCharCode.apply(0,g)}if(M(e.random(),n),c.exports){c.exports=l;try{f=bn}catch{}}else e["seed"+o]=l})(typeof self<"u"?self:F,[],Math)})(mn);var vn=rt,zn=st,Sn=ot,Mn=at,An=ct,jn=ut,I=lt;I.alea=vn;I.xor128=zn;I.xorwow=Sn;I.xorshift7=Mn;I.xor4096=An;I.tychei=jn;var $n=I;const jt=new URLSearchParams(window.location.search),dt=jt.get("seed")||Math.random().toString(16).substring(2);jt.get("seed")||window.history.replaceState(null,"",`?seed=${dt}`);Math.random=$n(dt);console.log(dt);const{cos:Dn,sin:$t,asin:Fn}=Math;function R(c,t){return Math.random()*(t-c)+c}const Ln=document.querySelector("canvas"),K=document.querySelector("svg"),En=new z(450,450),ht=new Zt(new w(R(-2,2),R(-2,2),R(-2,2))),Y=new Qt(En,ht),Dt=new ln(new w(R(-3,3),R(-3,3),R(-3,3)),new w(R(.5,1),R(.5,1),R(.5,1)),new w(1,1,1),new w(1,1,1));Y.addLight(Dt);function kn(c=.09,t=.01,n){const e=R(.8*c,1.2*c),i=R(.8*t,1.2*t),d=new bt(e,i),h=new ft(d);for(let o=1;o<5;o++){const r=new bt(e,i);r.position=n,r.rotation.y=o*.2*Math.PI+.1,h.union(r)}return h.color=new w(.1,0,.1),h.shininess=10,h}function qn(c=.09,t){const n=c/13,e=[{r:.3,y:.025},{r:.66,y:.125},{r:.84,y:.23},{r:.94,y:.33},{r:.98,y:.44},{r:.98,y:.56},{r:.94,y:.67},{r:.84,y:.77},{r:.66,y:.875},{r:.3,y:.975}];let i=null;for(let d=0;d<10;d++){const h=e[d],o=new sn(new w(h.r*c,n,h.r*c));o.position=t.addScalar(0),o.position.y+=h.y*c,o.rotation.y=d*.2,i?i.union(o):i=new ft(o)}return i}kn(.5,.05,new w(0,0,0));qn(.9,new w(0,-.3,0));let U;const Tn=[0,1.1,2,2.8,3.5,4.1,4.7,5.2,5.7,6.2],vt=[.015,.02,.03,.055,.065,.055,.08,.08,.09,.1];for(let c=0;c<10;c++){const t=Tn[c]-1,n=(.07+c*.005)*R(.97,1.05);let e=new an(n);e.position.x=Dn(t)*(.1+c*.05),e.position.z=$t(t)*(.1+c*.05),e.position.y=c*.04-.3,U?U.unionSmooth(e,R(vt[c]*.7,vt[c]*1.1)):U=new ft(e)}U.color=new w(.06,.06,.06);U.shininess=10;const On=new on(new w(.1,-1,1),.5);On.color=new w(.6,.45,.6);Y.add(U);let J=0;function Lt(){var t;let c;if(Dt.position=new w(0,0,0),J>5){K.remove();return}if(J+=1,c=new Date().getTime(),Y.render(K),console.log(`render svg: ${new Date().getTime()-c}ms`),window.location.hash==="#debug"&&(c=new Date().getTime(),Y.renderCanvas(Ln),console.log(`render canvas: ${new Date().getTime()-c}ms`)),window.location.hash==="#animate"){const n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttribute("viewBox",K.getAttribute("viewBox")||""),n.innerHTML=K.innerHTML,(t=document.querySelector(".frames"))==null||t.appendChild(n),ht.position.y=0+$t(Math.PI*.013*J),ht.position.z=1-.05*J,requestAnimationFrame(Lt)}}Lt();document.body.addEventListener("keydown",c=>{var t;if(c.metaKey&&c.key==="s"){c.preventDefault();const n=new Blob([((t=document.querySelector("svg"))==null?void 0:t.outerHTML)||""],{type:"image/svg;charset=utf-8"});it.saveAs(n,`${new Date().toLocaleString("en-GB")}.svg`)}c.metaKey&&c.key==="r"&&window.history.replaceState(null,"",`?seed=${Math.random().toString(16).substring(2)}`)});
