<!doctype html><html class=blue lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0" name=viewport><title>Animate React component by calling 'setState' in 'componentDidMount' · Muffin Man</title><meta content="On the frontend, we do a lot of animations. Most of the simple animations I create by using CSS transitions.
Either I will change class or inline styl…" name=description><meta content="Muffin Man" property=og:site_name><meta content="Animate React component by calling 'setState' in 'componentDidMount'" property=og:title><meta content="On the frontend, we do a lot of animations. Most of the simple animations I create by using CSS transitions.
Either I will change class or inline styl…" property=og:description><meta content=https://muffinman.io/blog/react-rerender-in-component-did-mount/ property=og:url><meta content="Animate React component by calling 'setState' in 'componentDidMount'" name=twitter:title><meta content="On the frontend, we do a lot of animations. Most of the simple animations I create by using CSS transitions.
Either I will change class or inline styl…" name=twitter:description><meta content=https://muffinman.io/favicon/blue/cover.png property=twitter:image><meta content=https://muffinman.io/favicon/blue/cover.png property=og:image><link href=/favicon/blue/icon-32.ico rel=icon sizes=any><link href=/favicon/blue/icon.svg rel=icon type=image/svg+xml><link href=/favicon/blue/icon-180.png rel=apple-touch-icon><link href=/favicon/blue/manifest.webmanifest rel=manifest><link href=/style.css rel=stylesheet><link href=/atom.xml rel=alternate title=RSS type=application/rss+xml><script>var isSystemDark=window.matchMedia("(prefers-color-scheme: dark)").matches;var userSelected=localStorage.getItem('color-scheme');var scheme='light-scheme';if(userSelected){scheme=userSelected}else if(isSystemDark){scheme='dark-scheme'};document.documentElement.classList.add(scheme)</script><body><div id=page><a class=jump-to-content href=#content>Jump to content</a><header class=menu><div class=container><a aria-label=Home class=menu__logo href=/> <svg viewbox="0 0 40 20" aria-hidden=true class=logo xmlns=http://www.w3.org/2000/svg><lineargradient id=logo-gradient><stop offset=0% stop-color=var(--gradient-color-1) /><stop offset=70% stop-color=var(--gradient-color-2) /></lineargradient><path d="M19.79.5h-2.603c-2.56 0-5.04 1.377-6.003 2.754C10.22 1.877 7.742.5 5.181.5H.5v19h4.681V5.181c1.79.083 3.855 1.35 3.855 3.993V19.5h4.296V9.174c0-2.644 2.065-3.91 3.855-3.993V19.5h5.204V5.181c1.79.083 3.855 1.35 3.855 3.993V19.5h4.296V9.174c0-2.644 2.065-3.91 3.855-3.993V19.5h4.681V.5h-4.68c-2.562 0-5.04 1.377-6.004 2.754C27.43 1.877 24.952.5 22.391.5Z" fill=url(#logo-gradient) stroke-linecap=round stroke-linejoin=round stroke-width=2px vector-effect=non-scaling-stroke /></svg> </a><button title="Switch color scheme" class=color-scheme-switcher><span aria-label="Switch to the dark color scheme" class=color-scheme-switcher__to-dark> <svg viewbox="0 0 20 20" aria-hidden=true height=20 width=20><path d="M19 11.6424L19.982 11.8312C20.0687 11.3804 19.8373 10.9286 19.4211 10.7354C19.0048 10.5421 18.5104 10.6571 18.222 11.0142L19 11.6424ZM8.35755 1L8.98583 1.77799C9.34289 1.48963 9.45783 0.995241 9.26458 0.578948C9.07134 0.162655 8.61953 -0.068649 8.16882 0.0179715L8.35755 1ZM18.222 11.0142C17.0163 12.5071 15.1742 13.4591 13.109 13.4591V15.4591C15.804 15.4591 18.2089 14.2136 19.778 12.2707L18.222 11.0142ZM13.109 13.4591C9.48151 13.4591 6.54086 10.5185 6.54086 6.89102H4.54086C4.54086 11.6231 8.37694 15.4591 13.109 15.4591V13.4591ZM6.54086 6.89102C6.54086 4.8258 7.49287 2.98365 8.98583 1.77799L7.72927 0.222011C5.78634 1.79106 4.54086 4.19595 4.54086 6.89102H6.54086ZM2 9.91827C2 5.98059 4.81714 2.69872 8.54628 1.98203L8.16882 0.0179715C3.51562 0.912252 0 5.00362 0 9.91827H2ZM10.0817 18C5.61831 18 2 14.3817 2 9.91827H0C0 15.4863 4.51374 20 10.0817 20V18ZM18.018 11.4537C17.3013 15.1829 14.0194 18 10.0817 18V20C14.9964 20 19.0878 16.4844 19.982 11.8312L18.018 11.4537Z" fill=currentColor /></svg> </span> <span aria-label="Switch to the light color scheme" class=color-scheme-switcher__to-light> <svg viewbox="0 0 26 26" aria-hidden=true height=26 width=26><g fill=none stroke=currentColor stroke-linecap=round stroke-width=2><circle cx=13 cy=13 r=5 /><path d="M13 4V1.5"/><path d="M13 24.5V22"/><path d="M4 13H1.5"/><path d="M24.5 13H22"/><path d="M6.63604 6.63604L4.86827 4.86827"/><path d="M21.1317 21.1317L19.364 19.364"/><path d="M6.63604 19.364L4.86827 21.1317"/><path d="M21.1317 4.86828L19.364 6.63605"/></g></svg> </span></button><nav class="nav nav--header"><a class="nav__item nav__item--with-icon" href=/art/> Art </a><span aria-hidden=true>/</span><a class=nav__item href=/archive/> Blog </a><span aria-hidden=true>/</span><a class=nav__item href=/about/> About </a><span aria-hidden=true>/</span><a class="nav__item nav__stats" href=/stats/> Stats </a><span aria-hidden=true class=nav__stats>/</span><button class="nav__item nav__item--with-icon" data-micromodal-trigger=modal-menu>Search <svg viewbox="0 0 20 32" aria-hidden=true class=nav__search-icon height=16 width=10 xmlns=http://www.w3.org/2000/svg><g fill=none stroke=currentColor stroke-linecap=round stroke-width=3><circle cx=10 cy=10 r=10 /><path d="M 10 20 L 10 32"/></g></svg></button></nav><button class="menu__toggle menu__toggle--static" aria-label=Menu data-micromodal-trigger=modal-menu><span></span> <span></span> <span></span></button></div><div class="menu__toggle-fixed-wrapper menu__toggle-fixed-wrapper--hidden"><button class="menu__toggle menu__toggle--fixed" aria-label=Menu data-micromodal-trigger=modal-menu tabindex=-1><span></span> <span></span> <span></span></button></div></header><div class=menu-stripe></div><section class=main id=content role=main tabindex=-1><div class=post__top><div class="container post__top-content"><h1 class=post__title>Animate React component by calling 'setState' in 'componentDidMount'</h1><div class=post__date>23. June 2017</div><div class=post__info><div>Posted in <a href=/archive/#react>React</a></div><span class=post__info-separator>·</span> 5 minutes read <div class=post__comments-link><a class=scroll-to href=#comments>8 Comments</a></div></div></div></div><div class=keyboard-svg-wrapper><svg viewbox="0 0 609 242" aria-hidden=true class=keyboard-svg xmlns=http://www.w3.org/2000/svg><g fill=#FFFFFF fill-rule=evenodd stroke=none stroke-width=1><rect class=key height=37 id=key--q rx=6 width=36 x=52 y=70></rect><rect class=key height=37 id=key--w rx=6 width=36 x=95 y=70></rect><rect class=key height=37 id=key--e rx=6 width=36 x=138 y=70></rect><rect class=key height=37 id=key--r rx=6 width=36 x=182 y=70></rect><rect class=key height=37 id=key--t rx=6 width=36 x=225 y=70></rect><rect class=key height=37 id=key--y rx=6 width=36 x=269 y=70></rect><rect class=key height=37 id=key--u rx=6 width=36 x=312 y=70></rect><rect class=key height=37 id=key--i rx=6 width=36 x=356 y=70></rect><rect class=key height=37 id=key--o rx=6 width=36 x=399 y=70></rect><rect class=key height=37 id=key--p rx=6 width=36 x=442 y=70></rect><rect class=key height=37 id=key--squareBracketLeft rx=6 width=36 x=486 y=70></rect><rect class=key height=37 id=key--squareBracketRight rx=6 width=36 x=529 y=70></rect><rect class=key height=37 id=key--backslash rx=6 width=36 x=573 y=70></rect><rect class=key height=37 id=key--tilde rx=6 width=36 x=1 y=25></rect><rect class=key height=37 id=key--1 rx=6 width=36 x=44 y=25></rect><rect class=key height=37 id=key--2 rx=6 width=36 x=88 y=25></rect><rect class=key height=37 id=key--3 rx=6 width=36 x=131 y=25></rect><rect class=key height=37 id=key--4 rx=6 width=36 x=175 y=25></rect><rect class=key height=37 id=key--5 rx=6 width=36 x=218 y=25></rect><rect class=key height=37 id=key--6 rx=6 width=36 x=262 y=25></rect><rect class=key height=37 id=key--7 rx=6 width=36 x=305 y=25></rect><rect class=key height=37 id=key--8 rx=6 width=36 x=348 y=25></rect><rect class=key height=37 id=key--9 rx=6 width=36 x=392 y=25></rect><rect class=key height=37 id=key--0 rx=6 width=36 x=435 y=25></rect><rect class=key height=37 id=key--minus rx=6 width=36 x=479 y=25></rect><rect class=key height=37 id=key--equals rx=6 width=36 x=522 y=25></rect><rect class=key height=18 id=key--esc rx=6 width=37 x=1 y=0></rect><rect class=key height=18 id=key--f1 rx=6 width=37 x=45 y=0></rect><rect class=key height=18 id=key--f2 rx=6 width=37 x=89 y=0></rect><rect class=key height=18 id=key--f3 rx=6 width=37 x=133 y=0></rect><rect class=key height=18 id=key--f4 rx=6 width=37 x=176 y=0></rect><rect class=key height=18 id=key--f5 rx=6 width=37 x=221 y=0></rect><rect class=key height=18 id=key--f6 rx=6 width=37 x=264 y=0></rect><rect class=key height=18 id=key--f7 rx=6 width=37 x=308 y=0></rect><rect class=key height=18 id=key--f8 rx=6 width=37 x=352 y=0></rect><rect class=key height=18 id=key--f9 rx=6 width=37 x=396 y=0></rect><rect class=key height=18 id=key--f10 rx=6 width=37 x=440 y=0></rect><rect class=key height=18 id=key--f11 rx=6 width=37 x=484 y=0></rect><rect class=key height=18 id=key--f12 rx=6 width=37 x=528 y=0></rect><rect class=key height=18 id=key--power rx=6 width=37 x=572 y=0></rect><rect class=key height=37 id=key--delete rx=6 width=43 x=566 y=25></rect><rect class=key height=37 id=key--a rx=6 width=36 x=65 y=114></rect><rect class=key height=37 id=key--s rx=6 width=36 x=109 y=114></rect><rect class=key height=37 id=key--d rx=6 width=36 x=152 y=114></rect><rect class=key height=37 id=key--f rx=6 width=36 x=195 y=114></rect><rect class=key height=37 id=key--g rx=6 width=36 x=239 y=114></rect><rect class=key height=37 id=key--h rx=6 width=36 x=282 y=114></rect><rect class=key height=37 id=key--j rx=6 width=36 x=326 y=114></rect><rect class=key height=37 id=key--k rx=6 width=36 x=369 y=114></rect><rect class=key height=37 id=key--l rx=6 width=36 x=413 y=114></rect><rect class=key height=37 id=key--semicolon rx=6 width=36 x=456 y=114></rect><rect class=key height=37 id=key--apostrophe rx=6 width=36 x=500 y=114></rect><rect class=key height=37 id=key--z rx=6 width=36 x=88 y=158></rect><rect class=key height=37 id=key--x rx=6 width=36 x=131 y=158></rect><rect class=key height=37 id=key--c rx=6 width=36 x=175 y=158></rect><rect class=key height=37 id=key--v rx=6 width=36 x=218 y=158></rect><rect class=key height=37 id=key--b rx=6 width=36 x=262 y=158></rect><rect class=key height=37 id=key--n rx=6 width=36 x=305 y=158></rect><rect class=key height=37 id=key--m rx=6 width=36 x=348 y=158></rect><rect class=key height=37 id=key--comma rx=6 width=36 x=392 y=158></rect><rect class=key height=37 id=key--dot rx=6 width=36 x=435 y=158></rect><rect class=key height=37 id=key--slash rx=6 width=36 x=479 y=158></rect><rect class=key height=37 id=key--fn rx=6 width=33 x=0 y=203></rect><rect class=key height=37 id=key--controlLeft rx=6 width=33 x=41 y=203></rect><rect class=key height=37 id=key--altLeft rx=6 width=33 x=81 y=203></rect><rect class=key height=37 id=key--altRight rx=6 width=33 x=444 y=203></rect><rect class=key height=19 id=key--arrowLeft rx=6 width=37 x=485 y=221></rect><g transform="translate(529.000000, 203.000000)" class=key id=key--arrowUp><path d="M37,11.5 L37,6 C37,2.6862915 34.3137085,-6.08718376e-16 31,0 L6,0 L6,0 C2.6862915,6.08718376e-16 -4.05812251e-16,2.6862915 0,6 L0,6 L0,11.5 L0,19 L37,19 L37,11.5 Z"></path></g><g transform="translate(529.000000, 222.000000)" class=key id=key--arrowDown><path d="M37,7.5 L37,13 C37,16.3137085 34.3137085,19 31,19 L6,19 C2.6862915,19 4.05812251e-16,16.3137085 0,13 L0,7.5 L0,0 L37,0 L37,7.5 Z"></path></g><rect class=key height=19 id=key--arrowRight rx=6 width=36 x=573 y=221></rect><rect class=key height=37 id=key--enter rx=6 width=66 x=543 y=114></rect><rect class=key height=37 id=key--cmdLeft rx=6 width=45 x=122 y=203></rect><rect class=key height=37 id=key--cmdRight rx=6 width=45 x=392 y=203></rect><rect class=key height=37 id=key--shiftRight rx=6 width=87 x=522 y=158></rect><rect class=key height=37 id=key--tab rx=6 width=44 x=0 y=70></rect><rect class=key height=37 id=key--capsLock rx=6 width=57 x=0 y=114></rect><rect class=key height=37 id=key--shiftLeft rx=6 width=80 x=0 y=158></rect><rect class=key height=37 id=key--space rx=6 width=210 x=175 y=203></rect></g></svg></div><div class="container post__container"><div class=content><p>On the frontend, we do a lot of animations. Most of the simple animations I create by using CSS transitions. Either I will change class or inline style of the element, and define transitions in CSS file.<p>Easiest way to do this in React is to render initial state, and then when it renders, change the state to apply class or style to animate. The easiest way to do it in React is to change state in <code>componentDidMount</code>. Setting state in <code>componentDidMount</code> is considered to be anti-pattern, as it forces rerender and can lead to property/layout thrashing. But in our case, that is exactly what we want to do.<p>When we do that, we hit the wall - only second state is rendered and there is no transition between two states. It happens because of browsers optimization - <strong>browsers are not rerendering stuff that changed in the same animation frame.</strong> But they merge changes and render the end result.<p>The problem I just described is not React exclusive, but browser related. Same will happen if we try something like this:<pre class="language-tsx z-code" data-lang=tsx><code class=language-tsx data-lang=tsx><span class="z-source z-tsx"><span class="z-meta z-var z-expr z-tsx"><span class="z-storage z-type z-tsx">const</span> <span class="z-meta z-var-single-variable z-expr z-tsx"><span class="z-meta z-definition z-variable z-tsx"><span class="z-variable z-other z-constant z-tsx">element</span></span> </span><span class="z-keyword z-operator z-assignment z-tsx">=</span> <span class="z-meta z-function-call z-tsx"><span class="z-support z-variable z-dom z-tsx">document</span><span class="z-punctuation z-accessor z-tsx">.</span><span class="z-support z-function z-dom z-tsx">querySelector</span></span><span class="z-meta z-brace z-round z-tsx">(</span><span class="z-string z-quoted z-single z-tsx"><span class="z-punctuation z-definition z-string z-begin z-tsx">'</span>.AnimateMe<span class="z-punctuation z-definition z-string z-end z-tsx">'</span></span><span class="z-meta z-brace z-round z-tsx">)</span></span><span class="z-punctuation z-terminator z-statement z-tsx">;</span>
<span class="z-variable z-other z-object z-tsx">element</span><span class="z-punctuation z-accessor z-tsx">.</span><span class="z-support z-variable z-property z-dom z-tsx">style</span><span class="z-punctuation z-accessor z-tsx">.</span><span class="z-support z-variable z-property z-dom z-tsx">height</span> <span class="z-keyword z-operator z-assignment z-tsx">=</span> <span class="z-string z-quoted z-single z-tsx"><span class="z-punctuation z-definition z-string z-begin z-tsx">'</span>50px<span class="z-punctuation z-definition z-string z-end z-tsx">'</span></span><span class="z-punctuation z-terminator z-statement z-tsx">;</span>
<span class="z-variable z-other z-object z-tsx">element</span><span class="z-punctuation z-accessor z-tsx">.</span><span class="z-support z-variable z-property z-dom z-tsx">style</span><span class="z-punctuation z-accessor z-tsx">.</span><span class="z-support z-variable z-property z-dom z-tsx">height</span> <span class="z-keyword z-operator z-assignment z-tsx">=</span> <span class="z-string z-quoted z-single z-tsx"><span class="z-punctuation z-definition z-string z-begin z-tsx">'</span>250px<span class="z-punctuation z-definition z-string z-end z-tsx">'</span></span><span class="z-punctuation z-terminator z-statement z-tsx">;</span>
</span></code></pre><p>So let's start with example of the problem.</p><span id=continue-reading></span><h2 id=animate-component-by-changing-state-in-componentdidmount-doesn-t-work>Animate component by changing state in <code>componentDidMount</code> doesn't work<a aria-label="Anchor link for: animate-component-by-changing-state-in-componentdidmount-doesn-t-work" title="Anchor link for: animate-component-by-changing-state-in-componentdidmount-doesn-t-work" class=header-anchor href=#animate-component-by-changing-state-in-componentdidmount-doesn-t-work> <span aria-hidden=true class=sr-only>#</span></a></h2><p>The scenario I described above. Element height depends on <code>this.state.animation</code> property. It is initially set to <code>false</code> and element height should be 50px. In <code>componentDidMount</code> we'll change the value of <code>this.props.animation</code> to <code>true</code> and element height should be 250px. As we added transition, it should animate.<p>But it doesn't as all of this happens really fast, and browser decides to merge changes and render only the end result. This way our element immediately gets height of 250px.<pre class="language-tsx z-code" data-lang=tsx><code class=language-tsx data-lang=tsx><span class="z-source z-tsx"><span class="z-meta z-import z-tsx"><span class="z-keyword z-control z-import z-tsx">import</span> <span class="z-variable z-other z-readwrite z-alias z-tsx">React</span><span class="z-punctuation z-separator z-comma z-tsx">,</span> <span class="z-meta z-block z-tsx"><span class="z-punctuation z-definition z-block z-tsx">{</span> <span class="z-variable z-other z-readwrite z-alias z-tsx">Component</span> <span class="z-punctuation z-definition z-block z-tsx">}</span></span> <span class="z-keyword z-control z-from z-tsx">from</span> <span class="z-string z-quoted z-single z-tsx"><span class="z-punctuation z-definition z-string z-begin z-tsx">'</span>react<span class="z-punctuation z-definition z-string z-end z-tsx">'</span></span></span><span class="z-punctuation z-terminator z-statement z-tsx">;</span>

<span class="z-meta z-export z-default z-tsx"><span class="z-keyword z-control z-export z-tsx">export</span> <span class="z-keyword z-control z-default z-tsx">default</span> <span class="z-meta z-class z-tsx"><span class="z-storage z-type z-class z-tsx">class</span> <span class="z-entity z-name z-type z-class z-tsx">AnimateMe</span> <span class="z-storage z-modifier z-tsx">extends</span> <span class="z-entity z-other z-inherited-class z-tsx">Component</span> <span class="z-punctuation z-definition z-block z-tsx">{</span>
<span class="z-meta z-method z-declaration z-tsx">  <span class="z-storage z-type z-tsx">constructor</span><span class="z-meta z-parameters z-tsx"><span class="z-punctuation z-definition z-parameters z-begin z-tsx">(</span><span class="z-variable z-parameter z-tsx">props</span><span class="z-punctuation z-definition z-parameters z-end z-tsx">)</span></span> <span class="z-meta z-block z-tsx"><span class="z-punctuation z-definition z-block z-tsx">{</span>
    <span class="z-meta z-function-call z-tsx"><span class="z-variable z-language z-super z-tsx">super</span></span><span class="z-meta z-brace z-round z-tsx">(</span><span class="z-variable z-other z-readwrite z-tsx">props</span><span class="z-meta z-brace z-round z-tsx">)</span><span class="z-punctuation z-terminator z-statement z-tsx">;</span>

    <span class="z-variable z-language z-this z-tsx">this</span><span class="z-punctuation z-accessor z-tsx">.</span><span class="z-variable z-other z-property z-tsx">state</span> <span class="z-keyword z-operator z-assignment z-tsx">=</span><span class="z-meta z-objectliteral z-tsx"> <span class="z-punctuation z-definition z-block z-tsx">{</span>
      <span class="z-meta z-object z-member z-tsx"><span class="z-meta z-object-literal z-key z-tsx">animate</span></span><span class="z-meta z-object z-member z-tsx"><span class="z-meta z-object-literal z-key z-tsx"><span class="z-punctuation z-separator z-key-value z-tsx">:</span></span> <span class="z-constant z-language z-boolean z-false z-tsx">false</span></span><span class="z-punctuation z-separator z-comma z-tsx">,</span>
    <span class="z-punctuation z-definition z-block z-tsx">}</span></span><span class="z-punctuation z-terminator z-statement z-tsx">;</span>
  <span class="z-punctuation z-definition z-block z-tsx">}</span></span></span>

<span class="z-meta z-method z-declaration z-tsx">  <span class="z-meta z-definition z-method z-tsx"><span class="z-entity z-name z-function z-tsx">componentDidMount</span></span><span class="z-meta z-parameters z-tsx"><span class="z-punctuation z-definition z-parameters z-begin z-tsx">(</span><span class="z-punctuation z-definition z-parameters z-end z-tsx">)</span></span> <span class="z-meta z-block z-tsx"><span class="z-punctuation z-definition z-block z-tsx">{</span>
    <span class="z-meta z-function-call z-tsx"><span class="z-variable z-language z-this z-tsx">this</span><span class="z-punctuation z-accessor z-tsx">.</span><span class="z-entity z-name z-function z-tsx">setState</span></span><span class="z-meta z-brace z-round z-tsx">(</span><span class="z-meta z-objectliteral z-tsx"><span class="z-punctuation z-definition z-block z-tsx">{</span> <span class="z-meta z-object z-member z-tsx"><span class="z-meta z-object-literal z-key z-tsx">animate</span></span><span class="z-meta z-object z-member z-tsx"><span class="z-meta z-object-literal z-key z-tsx"><span class="z-punctuation z-separator z-key-value z-tsx">:</span></span> <span class="z-constant z-language z-boolean z-true z-tsx">true</span> </span><span class="z-punctuation z-definition z-block z-tsx">}</span></span><span class="z-meta z-brace z-round z-tsx">)</span><span class="z-punctuation z-terminator z-statement z-tsx">;</span>
  <span class="z-punctuation z-definition z-block z-tsx">}</span></span></span>

<span class="z-meta z-method z-declaration z-tsx">  <span class="z-meta z-definition z-method z-tsx"><span class="z-entity z-name z-function z-tsx">render</span></span><span class="z-meta z-parameters z-tsx"><span class="z-punctuation z-definition z-parameters z-begin z-tsx">(</span><span class="z-punctuation z-definition z-parameters z-end z-tsx">)</span></span> <span class="z-meta z-block z-tsx"><span class="z-punctuation z-definition z-block z-tsx">{</span>
    <span class="z-keyword z-control z-flow z-tsx">return</span> <span class="z-meta z-brace z-round z-tsx">(</span>
      <span class="z-meta z-tag z-tsx"><span class="z-punctuation z-definition z-tag z-begin z-tsx"><</span><span class="z-entity z-name z-tag z-tsx">div</span><span class="z-meta z-tag z-attributes z-tsx">
        <span class="z-entity z-other z-attribute-name z-tsx">style</span><span class="z-keyword z-operator z-assignment z-tsx">=</span><span class="z-punctuation z-section z-embedded z-begin z-tsx">{</span><span class="z-meta z-embedded z-expression z-tsx"> <span class="z-meta z-objectliteral z-tsx"><span class="z-punctuation z-definition z-block z-tsx">{</span>
          <span class="z-meta z-object z-member z-tsx"><span class="z-meta z-object-literal z-key z-tsx">background</span></span><span class="z-meta z-object z-member z-tsx"><span class="z-meta z-object-literal z-key z-tsx"><span class="z-punctuation z-separator z-key-value z-tsx">:</span></span> <span class="z-string z-quoted z-single z-tsx"><span class="z-punctuation z-definition z-string z-begin z-tsx">'</span>#eee<span class="z-punctuation z-definition z-string z-end z-tsx">'</span></span></span><span class="z-punctuation z-separator z-comma z-tsx">,</span>
          <span class="z-meta z-object z-member z-tsx"><span class="z-meta z-object-literal z-key z-tsx">border</span></span><span class="z-meta z-object z-member z-tsx"><span class="z-meta z-object-literal z-key z-tsx"><span class="z-punctuation z-separator z-key-value z-tsx">:</span></span> <span class="z-string z-quoted z-single z-tsx"><span class="z-punctuation z-definition z-string z-begin z-tsx">'</span>1px solid black<span class="z-punctuation z-definition z-string z-end z-tsx">'</span></span></span><span class="z-punctuation z-separator z-comma z-tsx">,</span>
          <span class="z-meta z-object z-member z-tsx"><span class="z-meta z-object-literal z-key z-tsx">height</span></span><span class="z-meta z-object z-member z-tsx"><span class="z-meta z-object-literal z-key z-tsx"><span class="z-punctuation z-separator z-key-value z-tsx">:</span></span> <span class="z-variable z-language z-this z-tsx">this</span><span class="z-punctuation z-accessor z-tsx">.</span><span class="z-variable z-other z-object z-property z-tsx">state</span><span class="z-punctuation z-accessor z-tsx">.</span><span class="z-variable z-other z-property z-tsx">animate</span> <span class="z-keyword z-operator z-ternary z-tsx">?</span> <span class="z-constant z-numeric z-decimal z-tsx">250</span> <span class="z-keyword z-operator z-ternary z-tsx">:</span> <span class="z-constant z-numeric z-decimal z-tsx">50</span></span><span class="z-punctuation z-separator z-comma z-tsx">,</span>
          <span class="z-meta z-object z-member z-tsx"><span class="z-meta z-object-literal z-key z-tsx">margin</span></span><span class="z-meta z-object z-member z-tsx"><span class="z-meta z-object-literal z-key z-tsx"><span class="z-punctuation z-separator z-key-value z-tsx">:</span></span> <span class="z-constant z-numeric z-decimal z-tsx">20</span></span><span class="z-punctuation z-separator z-comma z-tsx">,</span>
          <span class="z-meta z-object z-member z-tsx"><span class="z-meta z-object-literal z-key z-tsx">padding</span></span><span class="z-meta z-object z-member z-tsx"><span class="z-meta z-object-literal z-key z-tsx"><span class="z-punctuation z-separator z-key-value z-tsx">:</span></span> <span class="z-constant z-numeric z-decimal z-tsx">20</span></span><span class="z-punctuation z-separator z-comma z-tsx">,</span>
          <span class="z-meta z-object z-member z-tsx"><span class="z-meta z-object-literal z-key z-tsx">transition</span></span><span class="z-meta z-object z-member z-tsx"><span class="z-meta z-object-literal z-key z-tsx"><span class="z-punctuation z-separator z-key-value z-tsx">:</span></span> <span class="z-string z-quoted z-single z-tsx"><span class="z-punctuation z-definition z-string z-begin z-tsx">'</span>all 2s<span class="z-punctuation z-definition z-string z-end z-tsx">'</span></span></span><span class="z-punctuation z-separator z-comma z-tsx">,</span>
        <span class="z-punctuation z-definition z-block z-tsx">}</span></span> </span><span class="z-punctuation z-section z-embedded z-end z-tsx">}</span>
      </span><span class="z-punctuation z-definition z-tag z-end z-tsx">></span><span class="z-meta z-jsx z-children z-tsx">
        Animate my height
      </span><span class="z-punctuation z-definition z-tag z-begin z-tsx">&LT/</span><span class="z-entity z-name z-tag z-tsx">div</span><span class="z-punctuation z-definition z-tag z-end z-tsx">></span></span>
    <span class="z-meta z-brace z-round z-tsx">)</span><span class="z-punctuation z-terminator z-statement z-tsx">;</span>
  <span class="z-punctuation z-definition z-block z-tsx">}</span></span></span>
<span class="z-punctuation z-definition z-block z-tsx">}</span></span></span>
</span></code></pre><iframe src="https://codepen.io/stanko/embed/XgaNyq?default-tab=result" title="Rerender React component in componentDidMount - Step 1" allowfullscreen allowtransparency frameborder=no height=400 loading=lazy scrolling=no>See the Pen <a href=https://codepen.io/stanko/pen/XgaNyq> Rerender React component in componentDidMount - Step 1</a> by Stanko (<a href=https://codepen.io/stanko>@stanko</a>) on <a href=https://codepen.io>CodePen</a>.</iframe><h2 id=solution-add-a-short-timeout>Solution, add a short timeout<a aria-label="Anchor link for: solution-add-a-short-timeout" title="Anchor link for: solution-add-a-short-timeout" class=header-anchor href=#solution-add-a-short-timeout> <span aria-hidden=true class=sr-only>#</span></a></h2><p>I've run multiple times into this problem, but I was lazy to dig deeper and find the real reason why it is happening. My solution was to add a timeout, first I tried immediate timeout (<code>setTimeout(fn, 0)</code>), but alas, it didn't work in some browsers (as it happened too fast again and browser did their optimizations). Then I increased it to the magical value 50 (<code>setTimeout(fn, 50)</code>), and it worked in every browser.<p>Now I get the reason why it works. Because 50ms is larger than animation frame (which is around 16ms to achieve 60fps).<p><small>(I'll show you just the part of the code that is changed)</small><pre class="language-tsx z-code" data-lang=tsx><code class=language-tsx data-lang=tsx><span class="z-source z-tsx"><span class="z-keyword z-operator z-spread z-tsx">...</span>
  <span class="z-meta z-function-call z-tsx"><span class="z-entity z-name z-function z-tsx">componentDidMount</span></span><span class="z-meta z-brace z-round z-tsx">(</span><span class="z-meta z-brace z-round z-tsx">)</span> <span class="z-meta z-block z-tsx"><span class="z-punctuation z-definition z-block z-tsx">{</span>
<span class="z-punctuation z-whitespace z-comment z-leading z-tsx">    </span><span class="z-comment z-line z-double-slash z-tsx"><span class="z-punctuation z-definition z-comment z-tsx">//</span></span><span class="z-comment z-line z-double-slash z-tsx"> Added timeout</span>
    <span class="z-meta z-var z-expr z-tsx"><span class="z-storage z-type z-tsx">const</span> <span class="z-meta z-var-single-variable z-expr z-tsx"><span class="z-meta z-definition z-variable z-tsx"><span class="z-variable z-other z-constant z-tsx">ANIMATION_TIMEOUT</span></span> </span><span class="z-keyword z-operator z-assignment z-tsx">=</span> <span class="z-constant z-numeric z-decimal z-tsx">50</span></span><span class="z-punctuation z-terminator z-statement z-tsx">;</span>

    <span class="z-meta z-function-call z-tsx"><span class="z-variable z-language z-this z-tsx">this</span><span class="z-punctuation z-accessor z-tsx">.</span><span class="z-entity z-name z-function z-tsx">setTimeout</span></span><span class="z-meta z-brace z-round z-tsx">(</span><span class="z-meta z-arrow z-tsx"><span class="z-meta z-parameters z-tsx"><span class="z-punctuation z-definition z-parameters z-begin z-tsx">(</span><span class="z-punctuation z-definition z-parameters z-end z-tsx">)</span></span> </span><span class="z-meta z-arrow z-tsx"><span class="z-storage z-type z-function z-arrow z-tsx">=></span> <span class="z-meta z-block z-tsx"><span class="z-punctuation z-definition z-block z-tsx">{</span>
      <span class="z-meta z-function-call z-tsx"><span class="z-variable z-language z-this z-tsx">this</span><span class="z-punctuation z-accessor z-tsx">.</span><span class="z-entity z-name z-function z-tsx">setState</span></span><span class="z-meta z-brace z-round z-tsx">(</span><span class="z-meta z-objectliteral z-tsx"><span class="z-punctuation z-definition z-block z-tsx">{</span> <span class="z-meta z-object z-member z-tsx"><span class="z-meta z-object-literal z-key z-tsx">animate</span></span><span class="z-meta z-object z-member z-tsx"><span class="z-meta z-object-literal z-key z-tsx"><span class="z-punctuation z-separator z-key-value z-tsx">:</span></span> <span class="z-constant z-language z-boolean z-true z-tsx">true</span> </span><span class="z-punctuation z-definition z-block z-tsx">}</span></span><span class="z-meta z-brace z-round z-tsx">)</span><span class="z-punctuation z-terminator z-statement z-tsx">;</span>
    <span class="z-punctuation z-definition z-block z-tsx">}</span></span></span><span class="z-punctuation z-separator z-comma z-tsx">,</span> <span class="z-variable z-other z-constant z-tsx">ANIMATION_TIMEOUT</span><span class="z-meta z-brace z-round z-tsx">)</span><span class="z-punctuation z-terminator z-statement z-tsx">;</span>
  <span class="z-punctuation z-definition z-block z-tsx">}</span></span>
<span class="z-keyword z-operator z-spread z-tsx">...</span>
</span></code></pre><iframe src="https://codepen.io/stanko/embed/WOERrE?default-tab=result" title="Rerender React component in componentDidMount - Step 2" allowfullscreen allowtransparency frameborder=no height=400 loading=lazy scrolling=no>See the Pen <a href=https://codepen.io/stanko/pen/WOERrE> Rerender React component in componentDidMount - Step 2</a> by Stanko (<a href=https://codepen.io/stanko>@stanko</a>) on <a href=https://codepen.io>CodePen</a>.</iframe><p>So this is cross browser solution, but I always cringe a little when I'm forced to use timeouts like this. And I have been talking about animation frames a lot, so why don't we try that next?<h2 id=using-requestanimationframe-instead-on-timeout>Using <code>requestAnimationFrame</code> instead on timeout<a aria-label="Anchor link for: using-requestanimationframe-instead-on-timeout" title="Anchor link for: using-requestanimationframe-instead-on-timeout" class=header-anchor href=#using-requestanimationframe-instead-on-timeout> <span aria-hidden=true class=sr-only>#</span></a></h2><p>We'll just replace timeout with <code>requestAnimationFrame</code> and it should work. But not in Firefox :( to make things worse, sometimes it does, and sometimes doesn't. My guess that sometimes it gets squeezed in to the same animation frame.<h3 id=update-october-2017>Update, October 2017<a aria-label="Anchor link for: update-october-2017" title="Anchor link for: update-october-2017" class=header-anchor href=#update-october-2017> <span aria-hidden=true class=sr-only>#</span></a></h3><p>Hooray! Firefox fixed this one, in newer versions it works without two nested <code>requestAnimationFrame</code>. But you might want to stick with it for some time, to make sure all of your users upgraded their browsers.<p><small>(Again just the part of the code that is changed)</small><pre class="language-tsx z-code" data-lang=tsx><code class=language-tsx data-lang=tsx><span class="z-source z-tsx"><span class="z-keyword z-operator z-spread z-tsx">...</span>
  <span class="z-meta z-function-call z-tsx"><span class="z-entity z-name z-function z-tsx">componentDidMount</span></span><span class="z-meta z-brace z-round z-tsx">(</span><span class="z-meta z-brace z-round z-tsx">)</span> <span class="z-meta z-block z-tsx"><span class="z-punctuation z-definition z-block z-tsx">{</span>
<span class="z-punctuation z-whitespace z-comment z-leading z-tsx">    </span><span class="z-comment z-line z-double-slash z-tsx"><span class="z-punctuation z-definition z-comment z-tsx">//</span></span><span class="z-comment z-line z-double-slash z-tsx"> Added requestAnimationFrame</span>
    <span class="z-meta z-function-call z-tsx"><span class="z-entity z-name z-function z-tsx">requestAnimationFrame</span></span><span class="z-meta z-brace z-round z-tsx">(</span><span class="z-meta z-arrow z-tsx"><span class="z-meta z-parameters z-tsx"><span class="z-punctuation z-definition z-parameters z-begin z-tsx">(</span><span class="z-punctuation z-definition z-parameters z-end z-tsx">)</span></span> </span><span class="z-meta z-arrow z-tsx"><span class="z-storage z-type z-function z-arrow z-tsx">=></span> <span class="z-meta z-block z-tsx"><span class="z-punctuation z-definition z-block z-tsx">{</span>
      <span class="z-meta z-function-call z-tsx"><span class="z-variable z-language z-this z-tsx">this</span><span class="z-punctuation z-accessor z-tsx">.</span><span class="z-entity z-name z-function z-tsx">setState</span></span><span class="z-meta z-brace z-round z-tsx">(</span><span class="z-meta z-objectliteral z-tsx"><span class="z-punctuation z-definition z-block z-tsx">{</span> <span class="z-meta z-object z-member z-tsx"><span class="z-meta z-object-literal z-key z-tsx">animate</span></span><span class="z-meta z-object z-member z-tsx"><span class="z-meta z-object-literal z-key z-tsx"><span class="z-punctuation z-separator z-key-value z-tsx">:</span></span> <span class="z-constant z-language z-boolean z-true z-tsx">true</span> </span><span class="z-punctuation z-definition z-block z-tsx">}</span></span><span class="z-meta z-brace z-round z-tsx">)</span><span class="z-punctuation z-terminator z-statement z-tsx">;</span>
    <span class="z-punctuation z-definition z-block z-tsx">}</span></span></span><span class="z-meta z-brace z-round z-tsx">)</span><span class="z-punctuation z-terminator z-statement z-tsx">;</span>
  <span class="z-punctuation z-definition z-block z-tsx">}</span></span>
<span class="z-keyword z-operator z-spread z-tsx">...</span>
</span></code></pre><iframe src="https://codepen.io/stanko/embed/JJyEoz?default-tab=result" title="Rerender React component in componentDidMount - Step 3" allowfullscreen allowtransparency frameborder=no height=400 loading=lazy scrolling=no>See the Pen <a href=https://codepen.io/stanko/pen/JJyEoz> Rerender React component in componentDidMount - Step 3</a> by Stanko (<a href=https://codepen.io/stanko>@stanko</a>) on <a href=https://codepen.io>CodePen</a>.</iframe><p>So now we need to make sure our two states belong to different animation frames each.<h2 id=nested-requestanimationframe-to-the-rescue>Nested <code>requestAnimationFrame</code> to the rescue<a aria-label="Anchor link for: nested-requestanimationframe-to-the-rescue" title="Anchor link for: nested-requestanimationframe-to-the-rescue" class=header-anchor href=#nested-requestanimationframe-to-the-rescue> <span aria-hidden=true class=sr-only>#</span></a></h2><p>Idea is to separate renders of two states to different animation frames. As we are not going to wrap React's <code>render</code> method into animation frame, we need to nest them instead in <code>componentDidMount</code>.<p>This way we guarantee first render won't be merged together with the second one. Problem we had in Firefox is now gone.<p>This looks hacky, but I think it is a legit solution. Instead of trying to get a <em>magic</em> value for timeout, just use native methods that browsers provide.<p><small>(Again just the part of the code that is changed)</small><pre class="language-tsx z-code" data-lang=tsx><code class=language-tsx data-lang=tsx><span class="z-source z-tsx"><span class="z-keyword z-operator z-spread z-tsx">...</span>
  <span class="z-meta z-function-call z-tsx"><span class="z-entity z-name z-function z-tsx">componentDidMount</span></span><span class="z-meta z-brace z-round z-tsx">(</span><span class="z-meta z-brace z-round z-tsx">)</span> <span class="z-meta z-block z-tsx"><span class="z-punctuation z-definition z-block z-tsx">{</span>
<span class="z-punctuation z-whitespace z-comment z-leading z-tsx">    </span><span class="z-comment z-line z-double-slash z-tsx"><span class="z-punctuation z-definition z-comment z-tsx">//</span></span><span class="z-comment z-line z-double-slash z-tsx"> Added two nested requestAnimationFrames</span>
    <span class="z-meta z-function-call z-tsx"><span class="z-entity z-name z-function z-tsx">requestAnimationFrame</span></span><span class="z-meta z-brace z-round z-tsx">(</span><span class="z-meta z-arrow z-tsx"><span class="z-meta z-parameters z-tsx"><span class="z-punctuation z-definition z-parameters z-begin z-tsx">(</span><span class="z-punctuation z-definition z-parameters z-end z-tsx">)</span></span> </span><span class="z-meta z-arrow z-tsx"><span class="z-storage z-type z-function z-arrow z-tsx">=></span> <span class="z-meta z-block z-tsx"><span class="z-punctuation z-definition z-block z-tsx">{</span>
<span class="z-punctuation z-whitespace z-comment z-leading z-tsx">      </span><span class="z-comment z-line z-double-slash z-tsx"><span class="z-punctuation z-definition z-comment z-tsx">//</span></span><span class="z-comment z-line z-double-slash z-tsx"> Firefox will sometimes merge changes that happened here</span>
      <span class="z-meta z-function-call z-tsx"><span class="z-entity z-name z-function z-tsx">requestAnimationFrame</span></span><span class="z-meta z-brace z-round z-tsx">(</span><span class="z-meta z-arrow z-tsx"><span class="z-meta z-parameters z-tsx"><span class="z-punctuation z-definition z-parameters z-begin z-tsx">(</span><span class="z-punctuation z-definition z-parameters z-end z-tsx">)</span></span> </span><span class="z-meta z-arrow z-tsx"><span class="z-storage z-type z-function z-arrow z-tsx">=></span> <span class="z-meta z-block z-tsx"><span class="z-punctuation z-definition z-block z-tsx">{</span>
        <span class="z-meta z-function-call z-tsx"><span class="z-variable z-language z-this z-tsx">this</span><span class="z-punctuation z-accessor z-tsx">.</span><span class="z-entity z-name z-function z-tsx">setState</span></span><span class="z-meta z-brace z-round z-tsx">(</span><span class="z-meta z-objectliteral z-tsx"><span class="z-punctuation z-definition z-block z-tsx">{</span> <span class="z-meta z-object z-member z-tsx"><span class="z-meta z-object-literal z-key z-tsx">animate</span></span><span class="z-meta z-object z-member z-tsx"><span class="z-meta z-object-literal z-key z-tsx"><span class="z-punctuation z-separator z-key-value z-tsx">:</span></span> <span class="z-constant z-language z-boolean z-true z-tsx">true</span> </span><span class="z-punctuation z-definition z-block z-tsx">}</span></span><span class="z-meta z-brace z-round z-tsx">)</span><span class="z-punctuation z-terminator z-statement z-tsx">;</span>
      <span class="z-punctuation z-definition z-block z-tsx">}</span></span></span><span class="z-meta z-brace z-round z-tsx">)</span><span class="z-punctuation z-terminator z-statement z-tsx">;</span>
    <span class="z-punctuation z-definition z-block z-tsx">}</span></span></span><span class="z-meta z-brace z-round z-tsx">)</span><span class="z-punctuation z-terminator z-statement z-tsx">;</span>
  <span class="z-punctuation z-definition z-block z-tsx">}</span></span>
<span class="z-keyword z-operator z-spread z-tsx">...</span>
</span></code></pre><iframe src="https://codepen.io/stanko/embed/JJyEXq?default-tab=result" title="Rerender React component in componentDidMount - Step 4" allowfullscreen allowtransparency frameborder=no height=400 loading=lazy scrolling=no>See the Pen <a href=https://codepen.io/stanko/pen/JJyEXq> Rerender React component in componentDidMount - Step 4</a> by Stanko (<a href=https://codepen.io/stanko>@stanko</a>) on <a href=https://codepen.io>CodePen</a>.</iframe><h2 id=finally-put-it-in-a-helper>Finally, put it in a helper<a aria-label="Anchor link for: finally-put-it-in-a-helper" title="Anchor link for: finally-put-it-in-a-helper" class=header-anchor href=#finally-put-it-in-a-helper> <span aria-hidden=true class=sr-only>#</span></a></h2><p>To make things a bit cleaner, I extract this to a helper function and then use whenever I need it. This can be used in our React examples but also with any other framework or vanilla JavaScript.<p>If you support browsers without <code>requestAnimationFrame</code> be sure to polyfill it. Paul Irish has a great one <a href=https://www.paulirish.com/2011/requestanimationframe-for-smart-animating/>here</a>.<pre class="language-tsx z-code" data-lang=tsx><code class=language-tsx data-lang=tsx><span class="z-source z-tsx"><span class="z-comment z-line z-double-slash z-tsx"><span class="z-punctuation z-definition z-comment z-tsx">//</span></span><span class="z-comment z-line z-double-slash z-tsx"> Start animation helper using nested requestAnimationFrames</span>
<span class="z-meta z-function z-tsx"><span class="z-storage z-type z-function z-tsx">function</span> <span class="z-meta z-definition z-function z-tsx"><span class="z-entity z-name z-function z-tsx">startAnimation</span></span><span class="z-meta z-parameters z-tsx"><span class="z-punctuation z-definition z-parameters z-begin z-tsx">(</span><span class="z-variable z-parameter z-tsx">callback</span><span class="z-punctuation z-definition z-parameters z-end z-tsx">)</span></span> <span class="z-meta z-block z-tsx"><span class="z-punctuation z-definition z-block z-tsx">{</span>
  <span class="z-meta z-function-call z-tsx"><span class="z-entity z-name z-function z-tsx">requestAnimationFrame</span></span><span class="z-meta z-brace z-round z-tsx">(</span><span class="z-meta z-arrow z-tsx"><span class="z-meta z-parameters z-tsx"><span class="z-punctuation z-definition z-parameters z-begin z-tsx">(</span><span class="z-punctuation z-definition z-parameters z-end z-tsx">)</span></span> </span><span class="z-meta z-arrow z-tsx"><span class="z-storage z-type z-function z-arrow z-tsx">=></span> <span class="z-meta z-block z-tsx"><span class="z-punctuation z-definition z-block z-tsx">{</span>
    <span class="z-meta z-function-call z-tsx"><span class="z-entity z-name z-function z-tsx">requestAnimationFrame</span></span><span class="z-meta z-brace z-round z-tsx">(</span><span class="z-meta z-arrow z-tsx"><span class="z-meta z-parameters z-tsx"><span class="z-punctuation z-definition z-parameters z-begin z-tsx">(</span><span class="z-punctuation z-definition z-parameters z-end z-tsx">)</span></span> </span><span class="z-meta z-arrow z-tsx"><span class="z-storage z-type z-function z-arrow z-tsx">=></span> <span class="z-meta z-block z-tsx"><span class="z-punctuation z-definition z-block z-tsx">{</span>
      <span class="z-meta z-function-call z-tsx"><span class="z-entity z-name z-function z-tsx">callback</span></span><span class="z-meta z-brace z-round z-tsx">(</span><span class="z-meta z-brace z-round z-tsx">)</span><span class="z-punctuation z-terminator z-statement z-tsx">;</span>
    <span class="z-punctuation z-definition z-block z-tsx">}</span></span></span><span class="z-meta z-brace z-round z-tsx">)</span><span class="z-punctuation z-terminator z-statement z-tsx">;</span>
  <span class="z-punctuation z-definition z-block z-tsx">}</span></span></span><span class="z-meta z-brace z-round z-tsx">)</span><span class="z-punctuation z-terminator z-statement z-tsx">;</span>
<span class="z-punctuation z-definition z-block z-tsx">}</span></span></span>
</span></code></pre><p><small>(Our <code>componentDidMount</code> code using helper)</small><pre class="language-tsx z-code" data-lang=tsx><code class=language-tsx data-lang=tsx><span class="z-source z-tsx"><span class="z-keyword z-operator z-spread z-tsx">...</span>
  <span class="z-meta z-function-call z-tsx"><span class="z-entity z-name z-function z-tsx">componentDidMount</span></span><span class="z-meta z-brace z-round z-tsx">(</span><span class="z-meta z-brace z-round z-tsx">)</span> <span class="z-meta z-block z-tsx"><span class="z-punctuation z-definition z-block z-tsx">{</span>
<span class="z-punctuation z-whitespace z-comment z-leading z-tsx">    </span><span class="z-comment z-line z-double-slash z-tsx"><span class="z-punctuation z-definition z-comment z-tsx">//</span></span><span class="z-comment z-line z-double-slash z-tsx"> You'll need to import startAnimation at the top of the file</span>
    <span class="z-meta z-function-call z-tsx"><span class="z-entity z-name z-function z-tsx">startAnimation</span></span><span class="z-meta z-brace z-round z-tsx">(</span><span class="z-meta z-arrow z-tsx"><span class="z-meta z-parameters z-tsx"><span class="z-punctuation z-definition z-parameters z-begin z-tsx">(</span><span class="z-punctuation z-definition z-parameters z-end z-tsx">)</span></span> </span><span class="z-meta z-arrow z-tsx"><span class="z-storage z-type z-function z-arrow z-tsx">=></span> <span class="z-meta z-block z-tsx"><span class="z-punctuation z-definition z-block z-tsx">{</span>
      <span class="z-meta z-function-call z-tsx"><span class="z-variable z-language z-this z-tsx">this</span><span class="z-punctuation z-accessor z-tsx">.</span><span class="z-entity z-name z-function z-tsx">setState</span></span><span class="z-meta z-brace z-round z-tsx">(</span><span class="z-meta z-objectliteral z-tsx"><span class="z-punctuation z-definition z-block z-tsx">{</span> <span class="z-meta z-object z-member z-tsx"><span class="z-meta z-object-literal z-key z-tsx">animate</span></span><span class="z-meta z-object z-member z-tsx"><span class="z-meta z-object-literal z-key z-tsx"><span class="z-punctuation z-separator z-key-value z-tsx">:</span></span> <span class="z-constant z-language z-boolean z-true z-tsx">true</span> </span><span class="z-punctuation z-definition z-block z-tsx">}</span></span><span class="z-meta z-brace z-round z-tsx">)</span><span class="z-punctuation z-terminator z-statement z-tsx">;</span>
    <span class="z-punctuation z-definition z-block z-tsx">}</span></span></span><span class="z-meta z-brace z-round z-tsx">)</span><span class="z-punctuation z-terminator z-statement z-tsx">;</span>
  <span class="z-punctuation z-definition z-block z-tsx">}</span></span>
<span class="z-keyword z-operator z-spread z-tsx">...</span>
</span></code></pre><h2 id=at-the-end>At the end<a aria-label="Anchor link for: at-the-end" title="Anchor link for: at-the-end" class=header-anchor href=#at-the-end> <span aria-hidden=true class=sr-only>#</span></a></h2><p>Hope you learned something, and I'm interested to hear if somebody is using different approach to solve this problem. Cheers!</div><div class=sharing><div class=h4>Share on:</div><div class=sharing__buttons><a class="sharing__button sharing__button--hn" href="http://news.ycombinator.com/submitlink?u=https%3A//muffinman.io/blog/react-rerender-in-component-did-mount/&t=Animate%20React%20component%20by%20calling%20%27setState%27%20in%20%27componentDidMount%27" title="Share post on Hacker News" rel=nofollow target=_blank> <svg viewbox="0 0 106 137" aria-hidden=true xmlns=http://www.w3.org/2000/svg><path d="M44.374 82.746.433.432h20.081l25.848 52.092c.398.928.862 1.889 1.392 2.883.53.994.994 2.022 1.391 3.082.266.398.464.762.597 1.094.133.33.265.63.398.894a65.643 65.643 0 0 1 1.79 3.877c.53 1.26.993 2.42 1.39 3.48a601.604 601.604 0 0 1 3.48-7.257c1.26-2.585 2.552-5.27 3.877-8.053L86.923.432h18.69L61.273 83.74v53.087h-16.9V82.746h.001Z"/></svg> </a><a class="sharing__button sharing__button--twitter" href="http://twitter.com/share?text=Animate%20React%20component%20by%20calling%20%27setState%27%20in%20%27componentDidMount%27&url=https%3A//muffinman.io/blog/react-rerender-in-component-did-mount/" title="Share post on Twitter" rel=nofollow target=_blank> <svg viewbox="0 0 24 24" aria-hidden=true xmlns=http://www.w3.org/2000/svg><path d="M23.444 4.834c-.814.363-1.5.375-2.228.016.938-.562.981-.957 1.32-2.019-.878.521-1.851.9-2.886 1.104a4.545 4.545 0 0 0-7.742 4.145 12.897 12.897 0 0 1-9.366-4.748 4.525 4.525 0 0 0-.615 2.285c0 1.577.803 2.967 2.021 3.782a4.527 4.527 0 0 1-2.057-.568l-.001.057a4.547 4.547 0 0 0 3.646 4.456 4.575 4.575 0 0 1-2.053.079 4.551 4.551 0 0 0 4.245 3.155A9.138 9.138 0 0 1 1 18.459 12.865 12.865 0 0 0 7.966 20.5c8.358 0 12.928-6.924 12.928-12.929 0-.198-.003-.393-.012-.588.887-.64 1.953-1.237 2.562-2.149z"/></svg> </a><a class="sharing__button sharing__button--reddit" href="http://www.reddit.com/submit?url=https%3A//muffinman.io/blog/react-rerender-in-component-did-mount/&title=Animate%20React%20component%20by%20calling%20%27setState%27%20in%20%27componentDidMount%27" title="Share post on reddit" rel=nofollow target=_blank> <svg viewbox="0 0 24 24" aria-hidden=true xmlns=http://www.w3.org/2000/svg><path d="M2.204 14.049c-.06.276-.091.56-.091.847 0 3.443 4.402 6.249 9.814 6.249 5.41 0 9.812-2.804 9.812-6.249 0-.274-.029-.546-.082-.809l-.015-.032a.456.456 0 0 1-.029-.165c-.302-1.175-1.117-2.241-2.296-3.103a.422.422 0 0 1-.126-.07c-.026-.02-.045-.042-.067-.064-1.792-1.234-4.356-2.008-7.196-2.008-2.815 0-5.354.759-7.146 1.971a.397.397 0 0 1-.179.124c-1.206.862-2.042 1.937-2.354 3.123a.454.454 0 0 1-.037.171l-.008.015zm9.773 5.441c-1.794 0-3.057-.389-3.863-1.197a.45.45 0 0 1 0-.632.47.47 0 0 1 .635 0c.63.629 1.685.943 3.228.943 1.542 0 2.591-.3 3.219-.929a.463.463 0 0 1 .629 0 .482.482 0 0 1 0 .645c-.809.808-2.065 1.198-3.862 1.198l.014-.028zm-3.606-7.573c-.914 0-1.677.765-1.677 1.677 0 .91.763 1.65 1.677 1.65s1.651-.74 1.651-1.65c0-.912-.739-1.677-1.651-1.677zm7.233 0c-.914 0-1.678.765-1.678 1.677 0 .91.764 1.65 1.678 1.65s1.651-.74 1.651-1.65c0-.912-.739-1.677-1.651-1.677zm4.548-1.595c1.037.833 1.8 1.821 2.189 2.904a1.818 1.818 0 0 0-2.189-2.902v-.002zM2.711 9.963a1.82 1.82 0 0 0-1.173 3.207c.401-1.079 1.172-2.053 2.213-2.876a1.82 1.82 0 0 0-1.039-.329v-.002zm9.217 12.079c-5.906 0-10.709-3.205-10.709-7.142 0-.275.023-.544.068-.809A2.723 2.723 0 0 1 0 11.777a2.725 2.725 0 0 1 2.725-2.713 2.7 2.7 0 0 1 1.797.682c1.856-1.191 4.357-1.941 7.112-1.992l1.812-5.524.404.095s.016 0 .016.002l4.223.993a2.237 2.237 0 0 1 4.296.874c0 1.232-1.003 2.234-2.231 2.234s-2.23-1.004-2.23-2.23l-3.851-.912-1.467 4.477c2.65.105 5.047.854 6.844 2.021a2.663 2.663 0 0 1 1.833-.719 2.716 2.716 0 0 1 2.718 2.711c0 .987-.54 1.886-1.378 2.365.029.255.059.494.059.749-.015 3.938-4.806 7.143-10.72 7.143l-.034.009zm8.179-19.187a1.339 1.339 0 1 0 0 2.678c.732 0 1.33-.6 1.33-1.334 0-.733-.598-1.332-1.347-1.332l.017-.012z"/></svg> </a></div></div></div><div class=post__bottom><div class=container><div class=related-posts><h2 class="h3 related-posts__title">Related Posts</h2><a class=related-posts__post href=https://muffinman.io/blog/react-simple-video-buffering-loader/> <div class=related-posts__post-title>Simple video buffering loader in React<svg viewbox="0 0 30 20" aria-hidden=true class=post-arrow xmlns=http://www.w3.org/2000/svg><path d="M 0 10 30 10 20 0 30 10 20 20"/></svg></div> <div class=related-posts__date>16. October 2020</div> </a><a class=related-posts__post href=https://muffinman.io/blog/react-router-v4-redirect-decorator/> <div class=related-posts__post-title>React Router v4 redirect decorator<svg viewbox="0 0 30 20" aria-hidden=true class=post-arrow xmlns=http://www.w3.org/2000/svg><path d="M 0 10 30 10 20 0 30 10 20 20"/></svg></div> <div class=related-posts__date>29. January 2018</div> </a><a class=related-posts__post href=https://muffinman.io/blog/react-ratio-component/> <div class=related-posts__post-title>React ratio<svg viewbox="0 0 30 20" aria-hidden=true class=post-arrow xmlns=http://www.w3.org/2000/svg><path d="M 0 10 30 10 20 0 30 10 20 20"/></svg></div> <div class=related-posts__date>23. January 2018</div> </a></div><div class=comments><h2 class="h3 comments__title" id=comments>Comments (8)</h2><div><div class=comment id=comment-3ff34970-91bb-11e7-acc3-59682e045002><div class=comment__top><img src="https://www.gravatar.com/avatar/9a4d8d0343e315a4d8a87fe23bce227d?d=mm&r=g" aria-hidden=true class=comment__avatar><div class=comment__right><div class="comment__name h5">Ariel</div><div class=comment__date>04. Sep 2017, 21:51</div></div></div><div class=comment__message><p>This tutorial is amazing. You are amazing.<p>I regularly read tutorials that leave <em>way</em> too much out or simply don't explain how they got to their solution.<p>This is spot on.<p>Love it! Please keep doing your thing!</div></div><div class=comment id=comment-4e6310e0-9200-11e7-83e6-5f4ca8e9a40d><div class=comment__top><div class="comment__avatar comment__avatar--mm"><svg viewbox="0 0 40 20" aria-hidden=true class=logo xmlns=http://www.w3.org/2000/svg><lineargradient id=logo-gradient><stop offset=0% stop-color=var(--gradient-color-1) /><stop offset=70% stop-color=var(--gradient-color-2) /></lineargradient><path d="M19.79.5h-2.603c-2.56 0-5.04 1.377-6.003 2.754C10.22 1.877 7.742.5 5.181.5H.5v19h4.681V5.181c1.79.083 3.855 1.35 3.855 3.993V19.5h4.296V9.174c0-2.644 2.065-3.91 3.855-3.993V19.5h5.204V5.181c1.79.083 3.855 1.35 3.855 3.993V19.5h4.296V9.174c0-2.644 2.065-3.91 3.855-3.993V19.5h4.681V.5h-4.68c-2.562 0-5.04 1.377-6.004 2.754C27.43 1.877 24.952.5 22.391.5Z" fill=url(#logo-gradient) stroke-linecap=round stroke-linejoin=round stroke-width=2px vector-effect=non-scaling-stroke /></svg></div><div class=comment__right><div class="comment__name h5">Stanko</div><div class=comment__date>05. Sep 2017, 06:06</div></div></div><div class=comment__message><p>You are welcome :) And thank you, I'm doing my best to write about real problems I encounter.<p>Cheers!</div></div><div class=comment id=comment-c8550ae0-9794-11e7-8d7a-93ae9661f3e7><div class=comment__top><img src="https://www.gravatar.com/avatar/21d5d76d61e1a368498826336440e3b7?d=mm&r=g" aria-hidden=true class=comment__avatar><div class=comment__right><div class="comment__name h5">Batu</div><div class=comment__date>12. Sep 2017, 08:31</div></div></div><div class=comment__message><p>Thank you!</div></div><div class=comment id=comment-19ac6a00-a7ad-11e7-ba25-ff198669fadf><div class=comment__top><img src="https://www.gravatar.com/avatar/7087e6dbd9dbddfb093ad400f1c042a6?d=mm&r=g" aria-hidden=true class=comment__avatar><div class=comment__right><div class="comment__name h5">Jimmy</div><div class=comment__date>02. Oct 2017, 20:05</div></div></div><div class=comment__message><p>Not sure why – but this method didn't work for me.<p>This appears to be the pattern at the moment: https://reactjs.org/docs/animation.html</div></div><div class=comment id=comment-33f21b50-a80f-11e7-8704-5b582ac668d2><div class=comment__top><div class="comment__avatar comment__avatar--mm"><svg viewbox="0 0 40 20" aria-hidden=true class=logo xmlns=http://www.w3.org/2000/svg><lineargradient id=logo-gradient><stop offset=0% stop-color=var(--gradient-color-1) /><stop offset=70% stop-color=var(--gradient-color-2) /></lineargradient><path d="M19.79.5h-2.603c-2.56 0-5.04 1.377-6.003 2.754C10.22 1.877 7.742.5 5.181.5H.5v19h4.681V5.181c1.79.083 3.855 1.35 3.855 3.993V19.5h4.296V9.174c0-2.644 2.065-3.91 3.855-3.993V19.5h5.204V5.181c1.79.083 3.855 1.35 3.855 3.993V19.5h4.296V9.174c0-2.644 2.065-3.91 3.855-3.993V19.5h4.681V.5h-4.68c-2.562 0-5.04 1.377-6.004 2.754C27.43 1.877 24.952.5 22.391.5Z" fill=url(#logo-gradient) stroke-linecap=round stroke-linejoin=round stroke-width=2px vector-effect=non-scaling-stroke /></svg></div><div class=comment__right><div class="comment__name h5">Stanko</div><div class=comment__date>03. Oct 2017, 07:48</div></div></div><div class=comment__message><p>Hello Jimmy, I'm sorry to hear it didn't work for you. Method works for sure, as you can see from the examples. I used it numerous times. You can check <a href=https://muffinman.io/react-animate-height/>react-animate-height</a> which is using it as well.<p><code>ReactTransitionGroup</code> and <code>ReactCSSTransitionGroup</code> are out for a while, but they do a little bit different thing.<p>Method I described is meant for a simple two-states animations. For such things I prefer doing it on my own rather than pulling whole library. Plus it gives you more control.<p>Cheers!</div></div><div class=comment id=comment-8b8a03d0-eace-11e7-a44f-935f90061bb7><div class=comment__top><img src="https://www.gravatar.com/avatar/d3e5192b0dbdba1f1d379e69526a82bc?d=mm&r=g" aria-hidden=true class=comment__avatar><div class=comment__right><div class="comment__name h5">Benjamin</div><div class=comment__date>27. Dec 2017, 06:24</div></div></div><div class=comment__message><p>I came here because animationFrame was updating too fast, and setting timeouts made it look choppy. Your double requestAnimationFrame did the trick. Would never have thought of that.</div></div><div class=comment id=comment-be87db50-715a-11e8-9910-8fe24f4e3f6a><div class=comment__top><img src="https://www.gravatar.com/avatar/bc6dfd1a2e713cd6a93c46e485294b8a?d=mm&r=g" aria-hidden=true class=comment__avatar><div class=comment__right><div class="comment__name h5">Aswin</div><div class=comment__date>16. Jun 2018, 11:45</div></div></div><div class=comment__message><p>Hi Stanko, Nice and clear write up. I have described my problem in the below "so" post. https://stackoverflow.com/questions/50881720/making-dom-updates-in-millisecond-intervals. Is rAF the way forward for websocket data too ?</div></div><div class=comment id=comment-54db1140-d654-11e8-9cf8-c9b6ddd6c0e8><div class=comment__top><img src="https://www.gravatar.com/avatar/0cf19129461493daaf6dd7bbb8fc1943?d=mm&r=g" aria-hidden=true class=comment__avatar><div class=comment__right><div class="comment__name h5">Daniel González González</div><div class=comment__date>22. Oct 2018, 23:43</div></div></div><div class=comment__message><p>Beautiful tutorial :)! Easy to adapt to different use cases. Thanks Stanko!</div></div></div></div></div></div></section><footer class=footer><div class="container footer__content"><a class=footer__rss-link href=/atom.xml target=_blank> <svg viewbox="0 0 8 8" aria-hidden=true xmlns=http://www.w3.org/2000/svg><g fill=currentColor transform=matrix(1.3329835,0,0,1.3333333,-0.12812669,-2.6739007)><ellipse cx=0.88595736 cy=7.2168303 rx=0.78983712 ry=0.78859526 /><path d="m 0.09769498,5.0054256 a 3,3 0 0 1 3.00000002,3 h 1 a 4,4 0 0 0 -4.00000002,-4 z"/><path d="m 0.09769498,3.0054256 a 5,5 0 0 1 5.00000002,5 h 1 a 6,6 0 0 0 -6.00000002,-6 z"/></g></svg> RSS Feed </a><div class=footer__text><a aria-label=Home class=footer__logo-link href=/> <svg viewbox="0 0 40 20" aria-hidden=true class=logo xmlns=http://www.w3.org/2000/svg><lineargradient id=logo-gradient><stop offset=0% stop-color=var(--gradient-color-1) /><stop offset=70% stop-color=var(--gradient-color-2) /></lineargradient><path d="M19.79.5h-2.603c-2.56 0-5.04 1.377-6.003 2.754C10.22 1.877 7.742.5 5.181.5H.5v19h4.681V5.181c1.79.083 3.855 1.35 3.855 3.993V19.5h4.296V9.174c0-2.644 2.065-3.91 3.855-3.993V19.5h5.204V5.181c1.79.083 3.855 1.35 3.855 3.993V19.5h4.296V9.174c0-2.644 2.065-3.91 3.855-3.993V19.5h4.681V.5h-4.68c-2.562 0-5.04 1.377-6.004 2.754C27.43 1.877 24.952.5 22.391.5Z" fill=url(#logo-gradient) stroke-linecap=round stroke-linejoin=round stroke-width=2px vector-effect=non-scaling-stroke /></svg> </a><p>© 2016-2022. All rights reserved.<p>Written with ♡ by Stanko Tadić.</div><nav class="nav nav--footer"><a class=nav__item href=/>Home</a><span aria-hidden=true>/</span><a class="nav__item nav__item--with-icon" href=/art/> Art </a><span aria-hidden=true>/</span><a class=nav__item href=/archive/> Blog </a><span aria-hidden=true>/</span><a class=nav__item href=/about/> About </a><span aria-hidden=true>/</span><a class="nav__item nav__stats" href=/stats/> Stats </a><span aria-hidden=true class=nav__stats>/</span><button class="nav__item nav__item--with-icon" data-micromodal-trigger=modal-menu>Search <svg viewbox="0 0 20 32" aria-hidden=true class=nav__search-icon height=16 width=10 xmlns=http://www.w3.org/2000/svg><g fill=none stroke=currentColor stroke-linecap=round stroke-width=3><circle cx=10 cy=10 r=10 /><path d="M 10 20 L 10 32"/></g></svg></button></nav></div></footer></div><div aria-hidden=true class=modal id=modal-menu><div aria-hidden=true class=modal__shadow></div><div aria-labelledby=modal-menu-title aria-modal=true class=modal__container role=dialog><main class=modal__content id=modal-menu-content><h2 class=sr-only id=modal-menu-title>Menu and search</h2><div class=menu><div class=container><a aria-label=Home class=menu__logo href=/> <svg viewbox="0 0 40 20" aria-hidden=true class=logo xmlns=http://www.w3.org/2000/svg><lineargradient id=logo-gradient><stop offset=0% stop-color=var(--gradient-color-1) /><stop offset=70% stop-color=var(--gradient-color-2) /></lineargradient><path d="M19.79.5h-2.603c-2.56 0-5.04 1.377-6.003 2.754C10.22 1.877 7.742.5 5.181.5H.5v19h4.681V5.181c1.79.083 3.855 1.35 3.855 3.993V19.5h4.296V9.174c0-2.644 2.065-3.91 3.855-3.993V19.5h5.204V5.181c1.79.083 3.855 1.35 3.855 3.993V19.5h4.296V9.174c0-2.644 2.065-3.91 3.855-3.993V19.5h4.681V.5h-4.68c-2.562 0-5.04 1.377-6.004 2.754C27.43 1.877 24.952.5 22.391.5Z" fill=url(#logo-gradient) stroke-linecap=round stroke-linejoin=round stroke-width=2px vector-effect=non-scaling-stroke /></svg> </a><button aria-label=Close class=menu__close data-micromodal-close><span></span> <span></span></button></div></div><div class=modal__top><div class=container><label class=sr-only for=search>Search</label><input autocomplete=off class=search__input id=search placeholder=Search></div></div><div class=modal__bottom><div class=container><div class=modal-nav><a class=h1 href=/art/> Art </a><a class=h1 href=/archive/> Blog </a><a class=h1 href=/about/> About </a><a class=h3 href=/stats/ style=modal-nav__link-margin> Stats </a><a class=h3 href=/atom.xml target=_blank> RSS Feed </a><a class=h3 href=https://github.com/stanko/ rel=noopener target=_blank> GitHub </a></div></div><div class=search__results></div></div></main></div></div><script src=/js/search-data.js></script><script src=/js/app.js></script><script async data-goatcounter=https://muffinman_io.goatcounter.com/count src=//gc.zgo.at/count.js></script>